var t={};t.GameCanvas=function(){this.Canvas=null,this.Context2D=null,this.BackBuffer=null,this.BackBufferContext2D=null},t.GameCanvas.prototype={Initialize:function(t,i,e){this.Canvas=document.getElementById(t),this.Context2D=this.Canvas.getContext("2d"),this.BackBuffer=document.createElement("canvas"),this.BackBuffer.width=i,this.BackBuffer.height=e,this.BackBufferContext2D=this.BackBuffer.getContext("2d")},BeginDraw:function(){this.BackBufferContext2D.clearRect(0,0,this.BackBuffer.width,this.BackBuffer.height),this.Context2D.clearRect(0,0,this.Canvas.width,this.Canvas.height)},EndDraw:function(){this.Context2D.drawImage(this.BackBuffer,0,0,this.BackBuffer.width,this.BackBuffer.height,0,0,this.Canvas.width,this.Canvas.height)}},t.MouseKeys={TAP:0,LEFT:1,MIDDLE:2,RIGHT:3},t.MouseInput={Events:new Array,Initialize:function(){var t=this;document.onmousedown=function(i){t.MouseDownEvent(i)},document.onmouseup=function(i){t.MouseUpEvent(i)},$("body").on("tap",function(i){t.MouseTapEvent(i)})},Reset:function(){this.Events=new Array},IsMouseDown:function(t){if(null==this.Events[t])return!1;var i=this.Events[t];return this.Events[t]=!1,i},IsMouseTap:function(){if(null==this.Events[t.MouseKeys.TAP])return!1;var i=this.Events[t.MouseKeys.TAP];return this.Events[t.MouseKeys.TAP]=!1,i},MouseTapEvent:function(t){this.Events[t.which]=!0},MouseDownEvent:function(t){this.Events[t.which]=!0},MouseUpEvent:function(t){this.Events[t.which]=!1}},t.Keys={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:80,Left:37,Up:38,Right:39,Down:40,AL:1,AU:100,AR:2,AD:3,AS:4,AA:101},t.KeyboardInput={Pressed:new Array,Initialize:function(){var t=this;document.onkeydown=function(i){t.KeyDownEvent(i)},document.onkeyup=function(i){t.KeyUpEvent(i)}},IsKeyDown:function(t){return null!=this.Pressed[t]&&this.Pressed[t]},KeyDownEvent:function(t){this.Pressed[t.keyCode]=!0,this.PreventScrolling(t)},KeyUpEvent:function(t){this.Pressed[t.keyCode]=!1,this.PreventScrolling(t)},PreventScrolling:function(t){t.keyCode>=37&&t.keyCode<=40&&t.preventDefault()}},t.Resources={Images:{},Sounds:{},Destroy:function(){return delete this.Images,delete this.Sounds,this},AddImage:function(t,i){var e=new Image;return this.Images[t]=e,e.src=i,this},AddImages:function(t){for(var i=0;i<t.length;i++){var e=new Image;this.Images[t[i].name]=e,e.src=t[i].src}return this},ClearImages:function(){return delete this.Images,this.Images=new Object,this},RemoveImage:function(t){return delete this.Images[t],this}},t.Drawable=function(){this.ZOrder=0},t.Drawable.prototype={Draw:function(){}},t.GameStateContext=function(t){this.State=null,null!=t&&(this.State=t,this.State.Enter())},t.GameStateContext.prototype={ChangeState:function(t){null!=this.State&&this.State.Exit(),this.State=t,this.State.Enter()},Update:function(t){this.State.CheckForChange(this),this.State.Update(t)},Draw:function(t){this.State.Draw(t)}},t.GameState=function(){},t.GameState.prototype={Enter:function(){},Exit:function(){},Update:function(){},Draw:function(){},CheckForChange:function(){}},t.GameTimer=function(){this.FramesPerSecond=1e3/35,this.LastTime=0,this.IntervalFunc=null,this.UpdateObject=null},t.GameTimer.prototype={Start:function(){this.LastTime=(new Date).getTime();var t=this;this.IntervalFunc=setInterval(function(){t.Tick()},this.FramesPerSecond)},Tick:function(){if(null!=this.UpdateObject){var t=(new Date).getTime(),i=(t-this.LastTime)/1e3;this.LastTime=t,this.UpdateObject.Update(i)}},Stop:function(){clearInterval(this.IntervalFunc)}},t.Camera=function(){this.X=0,this.Y=0},t.DrawableManager=function(){this.Unsorted=!0,this.Objects=[]},t.DrawableManager.prototype={Add:function(t){this.Objects.push(t),this.Unsorted=!0},AddRange:function(t){this.Objects=this.Objects.concat(t),this.Unsorted=!0},Clear:function(){this.Objects.splice(0,this.Objects.length)},Contains:function(t){for(var i=this.Objects.length;i--;)if(this.Objects[i]===t)return!0;return!1},Remove:function(t){var i=this.Objects.indexOf(t);this.Objects.splice(i,1)},RemoveAt:function(t){this.Objects.splice(t,1)},RemoveRange:function(t,i){this.Objects.splice(t,i)},RemoveList:function(t){var i=0,e=0;for(e=0;e<t.length;i++)for(i=0;i<this.Objects.length;i++)if(this.Objects[i]===t[e]){this.Objects.splice(i,1),t.splice(e,1),e--;break}},Update:function(t){var i=0;for(i=0;i<this.Objects.length;i++)this.Objects[i].Update&&this.Objects[i].Update(t)},Draw:function(t,i){this.Unsorted&&(this.Unsorted=!1,this.Objects.sort(function(t,i){return t.ZOrder-i.ZOrder}));var e=0;for(e=0;e<this.Objects.length;e++)this.Objects[e].Draw&&this.Objects[e].Draw(t,i)}},t.Sprite=function(){this.X=0,this.Y=0,this.Image=null},t.Sprite.prototype=new t.Drawable,t.Sprite.prototype.Draw=function(t,i){t.drawImage(this.Image,this.X-i.X,this.Y-i.Y)},t.SpriteFont=function(t,i,e,s,h){this.Image=i,this.Letters=h,this.LetterWidth=e,this.LetterHeight=s,this.Strings=t},t.SpriteFont.prototype=new t.Drawable,t.SpriteFont.prototype.Draw=function(t){for(var i=0;i<this.Strings.length;i++)for(var e=this.Strings[i],s=0;s<e.String.length;s++){var h=e.String.charCodeAt(s);t.drawImage(this.Image,this.Letters[h].X,this.Letters[h].Y,this.LetterWidth,this.LetterHeight,e.X+this.LetterWidth*(s+1),e.Y,this.LetterWidth,this.LetterHeight)}},t.FrameSprite=function(){this.FrameX=0,this.FrameY=0,this.FrameWidth=0,this.FrameHeight=0},t.FrameSprite.prototype=new t.Sprite,t.FrameSprite.prototype.Draw=function(t,i){t.drawImage(this.Image,this.FrameX,this.FrameY,this.FrameWidth,this.FrameHeight,this.X-i.X,this.Y-i.Y,this.FrameWidth,this.FrameHeight)},t.AnimationSequence=function(t,i,e,s){this.StartRow=t,this.StartColumn=i,this.EndRow=e,this.EndColumn=s,this.SingleFrame=!1,this.StartRow==this.EndRow&&this.StartColumn==this.EndColumn&&(this.SingleFrame=!0)},t.AnimatedSprite=function(){this.LastElapsed=0,this.FramesPerSecond=.05,this.CurrentSequence=null,this.Playing=!1,this.Looping=!1,this.Rows=0,this.Columns=0,this.Sequences=new Object},t.AnimatedSprite.prototype=new t.FrameSprite,t.AnimatedSprite.prototype.Update=function(t){if(!this.CurrentSequence.SingleFrame&&this.Playing&&(this.LastElapsed-=t,!(this.LastElapsed>0))){this.LastElapsed=this.FramesPerSecond,this.FrameX+=this.FrameWidth,this.FrameX>this.Image.width-this.FrameWidth&&(this.FrameX=0,this.FrameY+=this.FrameHeight,this.FrameY>this.Image.height-this.FrameHeight&&(this.FrameY=0));var i=!1;this.FrameX>this.CurrentSequence.EndColumn*this.FrameWidth&&this.FrameY==this.CurrentSequence.EndRow*this.FrameHeight?i=!0:0==this.FrameX&&this.FrameY>this.CurrentSequence.EndRow*this.FrameHeight&&(i=!0),i&&(this.Looping?(this.FrameX=this.CurrentSequence.StartColumn*this.FrameWidth,this.FrameY=this.CurrentSequence.StartRow*this.FrameHeight):this.Playing=!1)}},t.AnimatedSprite.prototype.PlaySequence=function(t,i){this.Playing=!0,this.Looping=i,this.CurrentSequence=this.Sequences["seq_"+t],this.FrameX=this.CurrentSequence.StartColumn*this.FrameWidth,this.FrameY=this.CurrentSequence.StartRow*this.FrameHeight},t.AnimatedSprite.prototype.StopLooping=function(){this.Looping=!1},t.AnimatedSprite.prototype.StopPlaying=function(){this.Playing=!1},t.AnimatedSprite.prototype.SetFrameWidth=function(t){this.FrameWidth=t,this.Rows=this.Image.width/this.FrameWidth},t.AnimatedSprite.prototype.SetFrameHeight=function(t){this.FrameHeight=t,this.Columns=this.Image.height/this.FrameHeight},t.AnimatedSprite.prototype.SetColumnCount=function(t){this.FrameWidth=this.Image.width/t,this.Columns=t},t.AnimatedSprite.prototype.SetRowCount=function(t){this.FrameHeight=this.Image.height/t,this.Rows=t},t.AnimatedSprite.prototype.AddExistingSequence=function(t,i){this.Sequences["seq_"+t]=i},t.AnimatedSprite.prototype.AddNewSequence=function(i,e,s,h,a){this.Sequences["seq_"+i]=new t.AnimationSequence(e,s,h,a)},t.AnimatedSprite.prototype.DeleteSequence=function(t){null!=this.Sequences["seq_"+t]&&delete this.Sequences["seq_"+t]},t.AnimatedSprite.prototype.ClearSequences=function(){delete this.Sequences,this.Sequences=new Object},t.Collideable=function(t,i,e,s){this.Base=t,this.X=t.X,this.Y=t.Y,this.Width=i,this.Height=e,this.CollisionEvent=null!=s?s:function(){}},t.Collideable.prototype={Update:function(){this.X=this.Base.X,this.Y=this.Base.Y},CheckCollision:function(t){var i=this.X,e=t.X,s=this.X+this.Width,h=t.X+t.Width,a=this.Y,r=t.Y,n=this.Y+this.Height,o=t.Y+t.Height;n<r||a>o||s<e||i>h||(this.CollisionEvent(t),t.CollisionEvent(this))}},t.Application=function(){this.canvas=null,this.timer=null,this.stateContext=null},t.Application.prototype={Update:function(t){this.stateContext.Update(t),this.canvas.BeginDraw(),this.stateContext.Draw(this.canvas.BackBufferContext2D),this.canvas.EndDraw()},Initialize:function(i,e,s){this.canvas=new t.GameCanvas,this.timer=new t.GameTimer,t.MouseInput.Initialize(),t.KeyboardInput.Initialize(),this.canvas.Initialize("canvas",e,s),this.timer.UpdateObject=this,this.stateContext=new t.GameStateContext(i),this.timer.Start()}};var i={},e=function(t,i,h){i&&$.each(i,function(a,r){h[a]?h[a](t,i,a):r?r instanceof Array?s(t,i,a,h):"object"==typeof r?e(t[a],i[a],h):t[a]=i[a]:t[a]=null})},s=function(t,i,h,a){t[h]=[];for(var r=0;r<i[h].length;++r)i[h][r]instanceof Array?s(t[h],i[h],r):"object"==typeof i[h][r]?(t[h][r]={},e(t[h][r],i[h][r],a)):t[h][r]=i[h][r]},h=function(t,e,s){t[s]=[],e[s].Width=200,e[s].Height=15;for(var h=0;h<e[s].Width;++h){t[s][h]=[];for(var a=0;a<e[s].Height;++a)t[s][h][a]=null}for(var h=0;h<e[s].Enemies.length;++h){var r=e[s].Enemies[h];t[s][r.X][r.Y]=new i.SpriteTemplate(r.Type,r.Winged)}};i.SpriteCuts={CreateBlackFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(0*n))},CreateRedFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(8*n))},CreateGreenFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(16*n))},CreateBlueFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(24*n))},CreateYellowFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(32*n))},CreatePinkFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(40*n))},CreateCyanFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(48*n))},CreateWhiteFont:function(){return new t.SpriteFont([],t.Resources.Images.font,8*n,8*n,this.GetCharArray(56*n))},GetCharArray:function(t){var i=[],e=0;for(e=32;e<127;e++)i[e]={X:(e-32)*n*8,Y:t};return i},GetBackgroundSheet:function(){var i=[],e=0,s=0,h=t.Resources.Images.background.width/32/n,a=t.Resources.Images.background.height/32/n;for(e=0;e<h;e++)for(i[e]=[],s=0;s<a;s++)i[e][s]={X:32*e*n,Y:32*s*n,Width:32*n,Height:32*n};return i},GetLevelSheet:function(){var i=[],e=0,s=0,h=t.Resources.Images.map.width/16/n,a=t.Resources.Images.map.height/16/n;for(e=0;e<h;e++)for(i[e]=[],s=0;s<a;s++)i[e][s]={X:16*e*n,Y:16*s*n,Width:16*n,Height:16*n};return i}},i.Tile={BlockUpper:1,BlockAll:2,BlockLower:4,Special:8,Bumpable:16,Breakable:32,PickUpable:64,Animated:128,Behaviors:[],LoadBehaviors:function(){var t=[];t[0]=0,t[1]=20,t[2]=28,t[3]=0,t[4]=130,t[5]=130,t[6]=130,t[7]=130,t[8]=2,t[9]=2,t[10]=2,t[11]=2,t[12]=2,t[13]=0,t[14]=138,t[15]=0,t[16]=162,t[17]=146,t[18]=154,t[19]=162,t[20]=146,t[21]=146,t[22]=154,t[23]=146,t[24]=2,t[25]=0,t[26]=2,t[27]=2,t[28]=2,t[29]=0,t[30]=2,t[31]=0,t[32]=192,t[33]=192,t[34]=192,t[35]=192,t[36]=0,t[37]=0,t[38]=0,t[39]=0,t[40]=2,t[41]=2,t[42]=0,t[43]=0,t[44]=0,t[45]=0,t[46]=2,t[47]=0,t[48]=0,t[49]=0,t[50]=0,t[51]=0,t[52]=0,t[53]=0,t[54]=0,t[55]=0,t[56]=2,t[57]=2;var i=0;for(i=58;i<128;i++)t[i]=0;for(t[128]=2,t[129]=2,t[130]=2,t[131]=0,t[132]=1,t[133]=1,t[134]=1,t[135]=0,t[136]=2,t[137]=2,t[138]=2,t[139]=0,t[140]=2,t[141]=2,t[142]=2,t[143]=0,t[144]=2,t[145]=0,t[146]=2,t[147]=0,t[148]=0,t[149]=0,t[150]=0,t[151]=0,t[152]=2,t[153]=2,t[154]=2,t[155]=0,t[156]=2,t[157]=2,t[158]=2,t[159]=0,t[160]=2,t[161]=2,t[162]=2,t[163]=0,t[164]=0,t[165]=0,t[166]=0,t[167]=0,t[168]=2,t[169]=2,t[170]=2,t[171]=0,t[172]=2,t[173]=2,t[174]=2,t[175]=0,t[176]=2,t[177]=2,t[178]=2,t[179]=0,t[180]=1,t[181]=1,t[182]=1,i=183;i<224;i++)t[i]=0;for(t[224]=1,t[225]=1,t[226]=1,i=227;i<256;i++)t[i]=0;this.Behaviors=t}},i.LevelType={Overground:0,Underground:1,Castle:2},i.Odds={Straight:0,HillStraight:1,Tubes:2,Jump:3,Cannons:4},i.Level=function(t,i){this.Width=t,this.Height=i,this.ExitX=10,this.ExitY=10,this.Map=[],this.Data=[],this.SpriteTemplates=[];var e=0,s=0;for(e=0;e<this.Width;e++)for(this.Map[e]=[],this.Data[e]=[],this.SpriteTemplates[e]=[],s=0;s<this.Height;s++)this.Map[e][s]=0,this.Data[e][s]=0,this.SpriteTemplates[e][s]=null},i.Level.prototype={Update:function(){var t=0,i=0;for(t=0;t<this.Width;t++)for(i=0;i<this.Height;i++)this.Data[t][i]>0&&this.Data[t][i]--},GetBlockCapped:function(t,i){return t<0&&(t=0),i<0&&(i=0),t>=this.Width&&(t=this.Width-1),i>=this.Height&&(i=this.Height-1),this.Map[t][i]},GetBlock:function(t,i){return t<0&&(t=0),i<0?0:(t>=this.Width&&(t=this.Width-1),i>=this.Height&&(i=this.Height-1),this.Map[t][i])},SetBlock:function(t,i,e){t<0||i<0||t>=this.Width||i>=this.Height||(this.Map[t][i]=e)},SetBlockData:function(t,i,e){t<0||i<0||t>=this.Width||i>=this.Height||(this.Data[t][i]=e)},IsBlocking:function(t,e,s,h){var a=this.GetBlock(t,e),r=(i.Tile.Behaviors[255&a]&i.Tile.BlockAll)>0;return r|=h>0&&(i.Tile.Behaviors[255&a]&i.Tile.BlockUpper)>0,r|=h<0&&(i.Tile.Behaviors[255&a]&i.Tile.BlockLower)>0},GetSpriteTemplate:function(t,i){return t<0?null:i<0?null:t>=this.Width?null:i>=this.Height?null:this.SpriteTemplates[t][i]},SetSpriteTemplate:function(t,i,e){t<0||i<0||t>=this.Width||i>=this.Height||(this.SpriteTemplates[t][i]=e)}},i.BackgroundGenerator=function(t,i,e,s){this.Width=t,this.Height=i,this.Distant=e,this.Type=s},i.BackgroundGenerator.prototype={SetValues:function(t,i,e,s){this.Width=t,this.Height=i,this.Distant=e,this.Type=s},CreateLevel:function(){var t=new i.Level(this.Width,this.Height);switch(this.Type){case i.LevelType.Overground:this.GenerateOverground(t);break;case i.LevelType.Underground:this.GenerateUnderground(t);break;case i.LevelType.Castle:this.GenerateCastle(t)}return t},GenerateOverground:function(t){var i=this.Distant?4:6,e=this.Distant?2:1,s=Math.floor(Math.random()*i)+e,h=Math.floor(Math.random()*i)+e,a=0,r=0,n=0,o=0,l=2;for(a=0;a<this.Width;a++){for(s=h;s===h;)h=Math.floor(Math.random()*i)+e;for(r=0;r<this.Height;r++)n=s<h?s:h,o=s<h?h:s,l=2,r<n?this.Distant?(l=2,r<2&&(l=r),t.SetBlock(a,r,4+8*l)):t.SetBlock(a,r,5):r===n?(l=n===h?0:1,l+=this.Distant?2:0,t.SetBlock(a,r,l)):r===o?(l=n===h?0:1,l+=this.Distant?2:0,t.SetBlock(a,r,l+16)):(l=r>o?1:0,n===s&&(l=1-l),l+=this.Distant?2:0,t.SetBlock(a,r,l+8))}},GenerateUnderground:function(t){var i=0,e=0,s=0,h=0;if(this.Distant){var a=0;for(i=0;i<this.Width;i++)for(Math.random()<.75&&(a=1-a),e=0;e<this.Height;e++)s=a,h=e-2,(h<0||h>4)&&(h=2,s=0),t.SetBlock(i,e,4+s+8*(3+h))}else for(i=0;i<this.Width;i++)for(e=0;e<this.Height;e++)s=i%2,h=e-1,(h<0||h>7)&&(h=7,s=0),0===s&&h>1&&h<5&&(s=-1,h=0),t.SetBlock(i,e,6+s+8*h)},GenerateCastle:function(t){var i=0,e=0,s=0,h=0;if(this.Distant)for(i=0;i<this.Width;i++)for(e=0;e<this.Height;e++)s=i%2,h=e-1,h>2&&h<5?h=2:h>=5&&(h-=2),h<0?(s=0,h=5):h>4?(s=1,h=5):s<1&&3===h?(s=0,h=3):s<1&&h>0&&h<3&&(s=0,h=2),t.SetBlock(i,e,1+s+8*(h+4));else for(i=0;i<this.Width;i++)for(e=0;e<this.Height;e++)s=i%3,h=e-1,h>2&&h<5?h=2:h>=5&&(h-=2),h<0?(s=1,h=5):h>4?(s=2,h=5):s<2&&4===h?(s=2,h=4):s<2&&h>0&&h<4&&(s=4,h=-3),t.SetBlock(i,e,1+s+8*(h+3))}},i.BackgroundRenderer=function(t,e,s,h){this.Level=t,this.Width=e,this.Distance=h,this.Background=i.SpriteCuts.GetBackgroundSheet(),this.FrameSize=this.Background[0][0].Width,this.FrameSizeLog=Math.log(this.FrameSize)/Math.log(2),this.TilesY=1+(s/this.FrameSize|0)},i.BackgroundRenderer.prototype=new t.Drawable,i.BackgroundRenderer.prototype.Draw=function(i,e){var s=e.X/this.Distance,h=0,a=0,r=null,n=null,o=s/this.FrameSize|0,l=(s+this.Width)/this.FrameSize|0;for(h=o;h<=l;h++)for(a=0;a<this.TilesY;a++)r=255&this.Level.GetBlock(h,a),n=this.Background[r%8][r/8|0],i.drawImage(t.Resources.Images.background,n.X,n.Y,n.Width,n.Height,(h<<this.FrameSizeLog)-s|0,a<<this.FrameSizeLog|0,n.Width,n.Height)},i.NotchSprite=function(t){this.XOld=0,this.YOld=0,this.X=0,this.Y=0,this.Xa=0,this.Ya=0,this.XPic=0,this.YPic=0,this.XPicO=0,this.YPicO=0,this.PicWidth=this.PicHeight=32*n,this.XFlip=!1,this.YFlip=!1,this.Visible=!0,this.Image=t,this.Delta=0,this.SpriteTemplate=null,this.Layer=1},i.NotchSprite.prototype=new t.Drawable,i.NotchSprite.prototype.Draw=function(t){var i=0,e=0;this.Visible&&(i=n*((this.XOld+(this.X-this.XOld)*this.Delta*n|0)-this.XPicO),e=n*((this.YOld+(this.Y-this.YOld)*this.Delta*n|0)-this.YPicO),t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-a:0,this.YFlip?-r:0),t.drawImage(this.Image,this.XPic*this.PicWidth,this.YPic*this.PicHeight,this.PicWidth,this.PicHeight,this.XFlip?a-i-this.PicWidth:i,this.YFlip?r-e-this.PicHeight:e,this.PicWidth,this.PicHeight),t.restore())},i.NotchSprite.prototype.Update=function(t){this.XOld=this.X,this.YOld=this.Y,this.Move(),this.Delta=t},i.NotchSprite.prototype.UpdateNoMove=function(){this.XOld=this.X,this.YOld=this.Y,this.Delta=0},i.NotchSprite.prototype.Move=function(){this.X+=this.Xa,this.Y+=this.Ya},i.NotchSprite.prototype.GetX=function(t){return(this.XOld+(this.X-this.XOld)*t|0)-this.XPicO},i.NotchSprite.prototype.GetY=function(t){return(this.YOld+(this.Y-this.YOld)*t|0)-this.YPicO},i.NotchSprite.prototype.CollideCheck=function(){},i.NotchSprite.prototype.BumpCheck=function(){},i.NotchSprite.prototype.Release=function(){},i.NotchSprite.prototype.ShellCollideCheck=function(){return!1},i.NotchSprite.prototype.FireballCollideCheck=function(){return!1},i.CharacterY=function(){this.Large=!0,this.Fire=!1,this.Coins=0,this.Lives=3,this.GroundInertia=.89,this.AirInertia=.89,this.RunTime=0,this.WasOnGround=!1,this.OnGround=!1,this.MayJump=!1,this.Ducking=!1,this.Sliding=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.CanShoot=!1,this.Width=4,this.Height=24,this.World=null,this.Facing=0,this.PowerUpTime=0,this.XDeathPos=0,this.YDeathPos=0,this.DeathTime=0,this.WinTime=0,this.InvulnerableTime=0,this.Carried=null,this.LastLarge=!1,this.LastFire=!1,this.NewLarge=!1,this.NewFire=!1},i.CharacterY.prototype=new i.NotchSprite(null),i.CharacterY.prototype.Initialize=function(t){this.World=t,this.X=32,this.Y=0,this.PowerUpTime=0,this.RunTime=0,this.WasOnGround=!1,this.OnGround=!1,this.MayJump=!1,this.Ducking=!1,this.Sliding=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.CanShoot=!1,this.Width=4,this.Height=24,this.World=t,this.Facing=0,this.PowerUpTime=0,this.XDeathPos=0,this.YDeathPos=0,this.DeathTime=0,this.WinTime=0,this.InvulnerableTime=0,this.Carried=null,this.SetLarge(this.Large,this.Fire),this.In=[[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1],[1],[],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[],[],[],[],[],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[4],[1,4],[1,4],[1,4],[1],[],[],[],[],[1],[1],[1],[1],[1],[1],[1],[1],[1],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2,4],[2,4],[2,4],[2,4],[4],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[],[],[],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[4],[4],[4],[4],[4],[4],[1,4],[1,4],[1,4],[1,4],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1],[1],[1],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[4],[4],[],[],[],[],[],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[],[],[],[],[],[4],[4],[4],[4],[1,4],[1,4],[1,4],[1,4],[1],[1],[1],[1,4],[1,4],[4],[],[4],[4],[4],[4],[4],[],[],[],[],[1],[1],[],[4],[4],[4],[4],[],[1],[1],[1],[4],[4],[4],[4],[],[],[],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1,4],[1,4],[1,4],[1,4],[1,4],[1,4],[1,4],[1,4],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2,4],[2,4],[2,4],[2],[2],[2,4],[2,4],[2,4],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1],[1,2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[],[],[],[4],[4],[4],[4],[4],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[4],[4],[4],[4],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[2,4],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[],[],[],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[38,2],[38,2],[38,2],[38],[38],[38],[38],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[],[],[],[],[],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[],[],[],[],[],[2],[2],[2],[],[],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1,2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[],[1],[1],[1],[1],[1],[],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[],[1,4],[1,4],[1,4],[1],[1],[1,4],[1,4],[1,4],[1],[1],[1,4],[1,4],[1,4],[1],[1],[1,4],[1,4],[1,4],[1],[1],[1],[1],[1],[1],[1],[1],[1,4],[1,4],[1,4],[1,4],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1,4],[1,4],[1,4],[1,4],[1],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2],[2],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[1],[1],[],[],[],[],[4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[4],[4],[4],[4],[4],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2,4],[4],[4],[],[],[],[],[2],[2],[2],[2,4],[4],[4],[4],[],[],[],[],[4],[4],[4],[],[2],[2],[2],[2],[4],[4],[4],[],[],[],[],[4],[4],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[],[],[],[],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[],[],[],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[2],[2],[],[],[],[],[],[1],[1],[1,4],[1],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[],[4],[4],[4],[4],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2,4],[2,4],[4],[4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[2,4],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[],[],[],[],[],[],[],[],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[],[],[],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[4],[4],[4],[2,4],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[],[],[],[],[],[1],[1],[1],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2],[2],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[],[],[],[],[],[],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[2,4],[2,4],[2,4],[2],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[],[],[],[],[],[1],[1],[1],[],[],[],[],[],[],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[],[],[],[1],[1],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[2],[2],[2],[],[1],[1],[],[],[],[],[],[],[],[],[],[1],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[2],[2],[],[1],[1],[1],[],[],[],[],[],[],[],[],[],[],[1],[1],[],[],[],[],[2],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[4],[4],[4],[4],[4],[],[],[],[1],[1],[1],[1],[1],[1],[1],[1],[1],[],[],[],[],[],[],[],[],[4],[4],[4],[1,4],[1,4],[1,4],[1,4],[1,4],[1],[1],[1],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[2],[2,4],[2,4],[2,4],[2,4],[2,4],[2,4],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[2],[2],[],[],[],[],[],[],[],[2],[2],[2],[],[],[],[],[2],[2],[2],[],[],[],[],[],[2],[2],[2],[],[],[],[2],[2],[],[],[],[2],[2],[2],[],[],[],[2],[2],[2],[],[],[],[2],[2],[],[],[],[],[2],[2],[],[],[],[],[2],[2],[2],[],[],[],[2],[2],[],[],[],[],[2],[],[],[],[],[2],[2],[],[],[],[2],[2],[],[],[],[2],[2],[2],[],[],[],[2],[2],[],[],[],[2],[2],[2],[],[],[],[2],[2],[2],[],[],[],[2],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[2],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[3],[],[],[],[],[],[],[],[],[]],this.InX=0,this.InLength=this.In.length},i.CharacterY.prototype.SetLarge=function(t,i){i&&(t=!0),t||(i=!1),this.LastLarge=this.Large,this.LastFire=this.Fire,this.Large=t,this.Fire=i,this.NewLarge=this.Large,this.NewFire=this.Fire,this.Blink(!0)},i.CharacterY.prototype.Blink=function(i){this.Large=i?this.NewLarge:this.LastLarge,this.Fire=i?this.NewFire:this.LastFire,this.Large?(this.Fire?this.Image=t.Resources.Images.fireMario:this.Image=t.Resources.Images.mario,this.XPicO=16,this.YPicO=31,this.PicWidth=this.PicHeight=32*n):(this.Image=t.Resources.Images.smallMario,this.XPicO=8,this.YPicO=15,this.PicWidth=this.PicHeight=16*n)},i.CharacterY.prototype.Move=function(){if(this.InX>0&&this.InX<this.InLength)for(var e=0;e<this.In[this.InX-1].length;++e)t.KeyboardInput.Pressed[this.In[this.InX-1][e]]=null;if(this.InX<this.InLength)for(var e=0;e<this.In[this.InX].length;++e)t.KeyboardInput.Pressed[this.In[this.InX][e]]=!0;if(this.InX++,this.WinTime>0)return this.WinTime++,this.Xa=0,void(this.Ya=0);if(this.DeathTime>0)return this.DeathTime++,this.DeathTime<11?(this.Xa=0,this.Ya=0):11===this.DeathTime?this.Ya=-15:this.Ya+=2,this.X+=this.Xa,void(this.Y+=this.Ya);if(0!==this.PowerUpTime)return this.PowerUpTime>0?(this.PowerUpTime--,this.Blink(0==(1&(this.PowerUpTime/3|0)))):(this.PowerUpTime++,this.Blink(0==(1&(-this.PowerUpTime/3|0)))),0===this.PowerUpTime&&(this.World.Paused=!1),void this.CalcPic();this.InvulnerableTime>0&&this.InvulnerableTime--,this.Visible=0==(1&(this.InvulerableTime/2|0)),this.WasOnGround=this.OnGround;var s=t.KeyboardInput.IsKeyDown(t.Keys.AA)?1.2:.6;this.OnGround&&(t.KeyboardInput.IsKeyDown(t.Keys.AD)&&this.Large?this.Ducking=!0:this.Ducking=!1),this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),t.KeyboardInput.IsKeyDown(t.Keys.AS)||this.JumpTime<0&&!this.OnGround&&!this.Sliding?this.JumpTime<0?(this.Xa=this.XJumpSpeed,this.Ya=-this.JumpTime*this.YJumpSpeed,this.JumpTime++):this.OnGround&&this.MayJump?(i.MPlayer.PlaySound("jump"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=7,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,
this.Sliding=!1):this.Sliding&&this.MayJump?(i.MPlayer.PlaySound("jump"),this.XJumpSpeed=6*-this.Facing,this.YJumpSpeed=-2,this.JumpTime=-6,this.Xa=this.XJumpSpeed,this.Ya=-this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.Facing=-this.Facing):this.JumpTime>0&&(this.Xa+=this.XJumpSpeed,this.Ya=this.JumpTime*this.YJumpSpeed,this.JumpTime--):this.JumpTime=0,t.KeyboardInput.IsKeyDown(t.Keys.AL)&&!this.Ducking&&(1===this.Facing&&(this.Sliding=!1),this.Xa-=s,this.JumpTime>=0&&(this.Facing=-1)),t.KeyboardInput.IsKeyDown(t.Keys.AR)&&!this.Ducking&&(this.Facing===-1&&(this.Sliding=!1),this.Xa+=s,this.JumpTime>=0&&(this.Facing=1)),(!t.KeyboardInput.IsKeyDown(t.Keys.AL)&&!t.KeyboardInput.IsKeyDown(t.Keys.AR)||this.Ducking||this.Ya<0||this.OnGround)&&(this.Sliding=!1),t.KeyboardInput.IsKeyDown(t.Keys.AA)&&this.CanShoot&&this.Fire&&this.World.FireballsOnScreen<2&&(i.MPlayer.PlaySound("fireball"),this.World.AddSprite(new i.Fireball(this.World,this.X+6*this.Facing,this.Y-20,this.Facing))),this.CanShoot=!t.KeyboardInput.IsKeyDown(t.Keys.AA),this.MayJump=(this.OnGround||this.Sliding)&&!t.KeyboardInput.IsKeyDown(t.Keys.AS),this.XFlip=this.Facing===-1,this.RunTime+=Math.abs(this.Xa)+5,Math.abs(this.Xa)<.5&&(this.RunTime=0,this.Xa=0),this.CalcPic(),this.Sliding&&(this.World.AddSprite(new i.Sparkle(this.World,(this.X+4*Math.random()-2|0)+8*this.Facing,(this.Y+4*Math.random()|0)-24,2*Math.random()-1,Math.random(),0,1,5)),this.Ya*=.5),this.OnGround=!1,this.SubMove(this.Xa,0),this.SubMove(0,this.Ya),this.Y>16*this.World.Level.Height+16&&this.Die(),this.X<0&&(this.X=0,this.Xa=0),this.X>16*this.World.Level.ExitX&&this.Win(),this.X>16*this.World.Level.Width&&(this.X=16*this.World.Level.Width,this.Xa=0),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=3),null!==this.Carried&&(this.Carried.X*=this.X+8*this.Facing,this.Carried.Y*=this.Y-2,t.KeyboardInput.IsKeyDown(t.Keys.AA)||(this.Carried.Release(this),this.Carried=null))},i.CharacterY.prototype.CalcPic=function(){var t=0,e=0;if(this.Large?(t=(this.RunTime/20|0)%4,3===t&&(t=1),null===this.Carried&&Math.abs(this.Xa)>10&&(t+=3),null!==this.Carried&&(t+=10),this.OnGround||(t=null!==this.Carried?12:Math.abs(this.Xa)>10?7:6)):(t=(this.RunTime/20|0)%2,null===this.Carried&&Math.abs(this.Xa)>10&&(t+=2),null!==this.Carried&&(t+=8),this.OnGround||(t=null!==this.Carried?9:Math.abs(this.Xa)>10?5:4)),this.OnGround&&(this.Facing===-1&&this.Xa>0||1===this.Facing&&this.Xa<0)&&((this.Xa>1||this.Xa<-1)&&(t=this.Large?9:7),this.Xa>3||this.Xa<-3))for(e=0;e<3;e++)this.World.AddSprite(new i.Sparkle(this.World,this.X+8*Math.random()-4|0,this.Y+4*Math.random()|0,2*Math.random()-1,Math.random()*-1,0,1,5));this.Large?(this.Ducking&&(t=14),this.Height=this.Ducking?12:24):this.Height=12,this.XPic=t},i.CharacterY.prototype.SubMove=function(t,i){for(var e=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;i>8;){if(!this.SubMove(0,8))return!1;i-=8}for(;i<-8;){if(!this.SubMove(0,-8))return!1;i+=8}return i>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t-this.Width,this.Y+i+1,t,i)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i+1,t,i)&&(e=!0)),i<0&&(this.IsBlocking(this.X+t,this.Y+i-this.Height,t,i)?e=!0:e||this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:(e||this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i))&&(e=!0)),t>0&&(this.Sliding=!0,this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t+this.Width,this.Y+i-(this.Height/2|0),t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t+this.Width,this.Y+i,t,i)?e=!0:this.Sliding=!1),t<0&&(this.Sliding=!0,this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t-this.Width,this.Y+i-(this.Height/2|0),t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t-this.Width,this.Y+i,t,i)?e=!0:this.Sliding=!1),e?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),i<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),i>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=i,!0)},i.CharacterY.prototype.IsBlocking=function(t,e,s,h){var a=!1,r=0,n=0,o=0;if(t=t/16|0,e=e/16|0,t===(this.X/16|0)&&e===(this.Y/16|0))return!1;if(r=this.World.Level.GetBlock(t,e),(i.Tile.Behaviors[255&r]&i.Tile.PickUpable)>0)for(this.GetCoin(),i.MPlayer.PlaySound("coin"),this.World.Level.SetBlock(t,e,0),n=0;n<2;n++)for(o=0;o<2;o++)this.World.AddSprite(new i.Sparkle(this.World,16*t+8*n+(8*Math.random()|0),16*e+8*o+(8*Math.random()|0),0,0,0,2,5));return a=this.World.Level.IsBlocking(t,e,s,h),a&&h<0&&this.World.Bump(t,e,this.Large),a},i.CharacterY.prototype.Stomp=function(e){var s=0;this.DeathTime>0||this.World.Paused||(s=e.Y-e.Height/2,this.SubMove(0,s-this.Y),e instanceof i.Enemy||e instanceof i.BulletBill?(i.MPlayer.PlaySound("kick"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=8,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.InvulnerableTime=1):e instanceof i.Shell&&(t.KeyboardInput.IsKeyDown(t.Keys.AA)&&0===e.Facing?(this.Carried=e,e.Carried=!0):(i.MPlayer.PlaySound("kick"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=8,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.InvulnerableTime=1)))},i.CharacterY.prototype.GetHurt=function(){this.DeathTime>0||this.World.Paused||this.InvulnerableTime>0||(this.Large?(this.World.Paused=!0,this.PowerUpTime=-18,i.MPlayer.PlaySound("powerdown"),this.Fire?this.SetLarge(!0,!1):this.SetLarge(!1,!1),this.InvulnerableTime=32):this.Die())},i.CharacterY.prototype.Win=function(){this.XDeathPos=0|this.X,this.YDeathPos=0|this.Y,this.World.Paused=!0,this.WinTime=1,i.MPlayer.PlaySound("exit")},i.CharacterY.prototype.Die=function(){this.XDeathPos=0|this.X,this.YDeathPos=0|this.Y,this.World.Paused=!0,this.DeathTime=1,i.MPlayer.PlaySound("death"),this.SetLarge(!1,!1)},i.CharacterY.prototype.GetFlower=function(){this.DeathTime>0&&this.World.Paused||(this.Fire?(this.GetCoin(),i.MPlayer.PlaySound("coin")):(this.World.Paused=!0,this.PowerUpTime=18,i.MPlayer.PlaySound("powerup"),this.SetLarge(!0,!0)))},i.CharacterY.prototype.GetRing=function(t){this.DeathTime>0&&this.World.Paused||(this.Ring=t,i.MPlayer.PlaySound("coin"))},i.CharacterY.prototype.GetMushroom=function(){this.DeathTime>0&&this.World.Paused||(this.Large?(this.GetCoin(),i.MPlayer.PlaySound("coin")):(this.World.Paused=!0,this.PowerUpTime=18,i.MPlayer.PlaySound("powerup"),this.SetLarge(!0,!1)))},i.CharacterY.prototype.Kick=function(e){this.DeathTime>0&&this.World.Paused||(t.KeyboardInput.IsKeyDown(t.Keys.AA)?(this.Carried=e,e.Carried=!0):(i.MPlayer.PlaySound("kick"),this.InvulnerableTime=1))},i.CharacterY.prototype.Get1Up=function(){i.MPlayer.PlaySound("1up"),99==++this.Lives&&(this.Lives=99)},i.CharacterY.prototype.GetCoin=function(){100==++this.Coins&&(this.Coins=0,this.Get1Up())},i.Character2=function(){this.Large=!0,this.Fire=!1,this.Coins=0,this.Lives=3,this.LevelString="none",this.GroundInertia=.89,this.AirInertia=.89,this.RunTime=0,this.WasOnGround=!1,this.OnGround=!1,this.MayJump=!1,this.Ducking=!1,this.Sliding=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.CanShoot=!1,this.Width=4,this.Height=24,this.World=null,this.Facing=0,this.PowerUpTime=0,this.XDeathPos=0,this.YDeathPos=0,this.DeathTime=0,this.WinTime=0,this.InvulnerableTime=0,this.Carried=null,this.LastLarge=!1,this.LastFire=!1,this.NewLarge=!1,this.NewFire=!1},i.Character2.prototype=new i.NotchSprite(null),i.Character2.prototype.Initialize=function(t){this.World=t,this.X=3120,this.Y=160,this.PowerUpTime=0,this.RunTime=0,this.WasOnGround=!1,this.OnGround=!1,this.MayJump=!1,this.Ducking=!1,this.Sliding=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.CanShoot=!1,this.Width=4,this.Height=24,this.World=t,this.Facing=-1,this.PowerUpTime=0,this.XDeathPos=0,this.YDeathPos=0,this.DeathTime=0,this.WinTime=0,this.InvulnerableTime=0,this.Carried=null,this.SetLarge(this.Large,this.Fire)},i.Character2.prototype.SetLarge=function(t,i){i&&(t=!0),t||(i=!1),this.LastLarge=this.Large,this.LastFire=this.Fire,this.Large=t,this.Fire=i,this.NewLarge=this.Large,this.NewFire=this.Fire,this.Blink(!0)},i.Character2.prototype.Blink=function(i){this.Large=i?this.NewLarge:this.LastLarge,this.Fire=i?this.NewFire:this.LastFire,this.Large?(this.Fire?this.Image=t.Resources.Images.fireMario:this.Image=t.Resources.Images.mario,this.YPic=1,this.XPicO=16,this.YPicO=31,this.PicWidth=this.PicHeight=32*n):(this.YPic=0,this.Image=t.Resources.Images.smallMario,this.XPicO=8,this.YPicO=15,this.PicWidth=this.PicHeight=16*n)},i.Character2.prototype.Move=function(){if(this.WinTime>0)return this.WinTime++,this.Xa=0,void(this.Ya=0);if(this.DeathTime>0)return this.DeathTime++,this.DeathTime<11?(this.Xa=0,this.Ya=0):11===this.DeathTime?this.Ya=-15:this.Ya+=2,this.X+=this.Xa,void(this.Y+=this.Ya);if(0!==this.PowerUpTime)return this.PowerUpTime>0?(this.PowerUpTime--,this.Blink(0==(1&(this.PowerUpTime/3|0)))):(this.PowerUpTime++,this.Blink(0==(1&(-this.PowerUpTime/3|0)))),0===this.PowerUpTime&&(this.World.Paused=!1),void this.CalcPic();this.InvulnerableTime>0&&this.InvulnerableTime--,this.Visible=0==(1&(this.InvulerableTime/2|0)),this.WasOnGround=this.OnGround;var e=t.KeyboardInput.IsKeyDown(t.Keys.Q)?1.2:.6;this.OnGround&&(t.KeyboardInput.IsKeyDown(t.Keys.G)&&this.Large?this.Ducking=!0:this.Ducking=!1),this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),t.KeyboardInput.IsKeyDown(t.Keys.W)||this.JumpTime<0&&!this.OnGround&&!this.Sliding?this.JumpTime<0?(this.Xa=this.XJumpSpeed,this.Ya=-this.JumpTime*this.YJumpSpeed,this.JumpTime++):this.OnGround&&this.MayJump?(i.MPlayer.PlaySound("jump"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=7,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1):this.Sliding&&this.MayJump?(i.MPlayer.PlaySound("jump"),this.XJumpSpeed=6*-this.Facing,this.YJumpSpeed=-2,this.JumpTime=-6,this.Xa=this.XJumpSpeed,this.Ya=-this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.Facing=-this.Facing):this.JumpTime>0&&(this.Xa+=this.XJumpSpeed,this.Ya=this.JumpTime*this.YJumpSpeed,this.JumpTime--):this.JumpTime=0,t.KeyboardInput.IsKeyDown(t.Keys.F)&&!this.Ducking&&(1===this.Facing&&(this.Sliding=!1),this.Xa-=e,this.JumpTime>=0&&(this.Facing=-1)),t.KeyboardInput.IsKeyDown(t.Keys.H)&&!this.Ducking&&(this.Facing===-1&&(this.Sliding=!1),this.Xa+=e,this.JumpTime>=0&&(this.Facing=1)),(!t.KeyboardInput.IsKeyDown(t.Keys.F)&&!t.KeyboardInput.IsKeyDown(t.Keys.H)||this.Ducking||this.Ya<0||this.OnGround)&&(this.Sliding=!1),t.KeyboardInput.IsKeyDown(t.Keys.Q)&&this.CanShoot&&this.Fire&&this.World.FireballsOnScreen<2&&(i.MPlayer.PlaySound("fireball"),this.World.AddSprite(new i.Fireball(this.World,this.X+6*this.Facing,this.Y-20,this.Facing))),this.CanShoot=!t.KeyboardInput.IsKeyDown(t.Keys.Q),this.MayJump=(this.OnGround||this.Sliding)&&!t.KeyboardInput.IsKeyDown(t.Keys.W),this.XFlip=this.Facing===-1,this.RunTime+=Math.abs(this.Xa)+5,Math.abs(this.Xa)<.5&&(this.RunTime=0,this.Xa=0),this.CalcPic(),this.Sliding&&(this.World.AddSprite(new i.Sparkle(this.World,(this.X+4*Math.random()-2|0)+8*this.Facing,(this.Y+4*Math.random()|0)-24,2*Math.random()-1,Math.random(),0,1,5)),this.Ya*=.5),this.OnGround=!1,this.SubMove(this.Xa,0),this.SubMove(0,this.Ya),this.Y>16*this.World.Level.Height+16&&this.Die(),this.X<0&&(this.X=0,this.Xa=0),this.X>16*this.World.Level.ExitX&&this.Win(),this.X>16*this.World.Level.Width&&(this.X=16*this.World.Level.Width,this.Xa=0),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=3),null!==this.Carried&&(this.Carried.X*=this.X+8*this.Facing,this.Carried.Y*=this.Y-2,t.KeyboardInput.IsKeyDown(t.Keys.Q)||(this.Carried.Release(this),this.Carried=null))},i.Character2.prototype.CalcPic=function(){var t=0,e=0;if(this.Large?(t=(this.RunTime/20|0)%4,3===t&&(t=1),null===this.Carried&&Math.abs(this.Xa)>10&&(t+=3),null!==this.Carried&&(t+=10),this.OnGround||(t=null!==this.Carried?12:Math.abs(this.Xa)>10?7:6)):(t=(this.RunTime/20|0)%2,null===this.Carried&&Math.abs(this.Xa)>10&&(t+=2),null!==this.Carried&&(t+=8),this.OnGround||(t=null!==this.Carried?9:Math.abs(this.Xa)>10?5:4)),this.OnGround&&(this.Facing===-1&&this.Xa>0||1===this.Facing&&this.Xa<0)&&((this.Xa>1||this.Xa<-1)&&(t=this.Large?9:7),this.Xa>3||this.Xa<-3))for(e=0;e<3;e++)this.World.AddSprite(new i.Sparkle(this.World,this.X+8*Math.random()-4|0,this.Y+4*Math.random()|0,2*Math.random()-1,Math.random()*-1,0,1,5));this.Large?(this.Ducking&&(t=14),this.Height=this.Ducking?12:24):this.Height=12,this.XPic=t},i.Character2.prototype.SubMove=function(t,i){for(var e=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;i>8;){if(!this.SubMove(0,8))return!1;i-=8}for(;i<-8;){if(!this.SubMove(0,-8))return!1;i+=8}return i>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t-this.Width,this.Y+i+1,t,i)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i+1,t,i)&&(e=!0)),i<0&&(this.IsBlocking(this.X+t,this.Y+i-this.Height,t,i)?e=!0:e||this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:(e||this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i))&&(e=!0)),t>0&&(this.Sliding=!0,this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t+this.Width,this.Y+i-(this.Height/2|0),t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t+this.Width,this.Y+i,t,i)?e=!0:this.Sliding=!1),t<0&&(this.Sliding=!0,this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t-this.Width,this.Y+i-(this.Height/2|0),t,i)?e=!0:this.Sliding=!1,this.IsBlocking(this.X+t-this.Width,this.Y+i,t,i)?e=!0:this.Sliding=!1),e?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),i<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),i>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=i,!0)},i.Character2.prototype.IsBlocking=function(t,e,s,h){var a=!1,r=0,n=0,o=0;if(t=t/16|0,e=e/16|0,t===(this.X/16|0)&&e===(this.Y/16|0))return!1;if(r=this.World.Level.GetBlock(t,e),(i.Tile.Behaviors[255&r]&i.Tile.PickUpable)>0)for(this.GetCoin(),i.MPlayer.PlaySound("coin"),this.World.Level.SetBlock(t,e,0),n=0;n<2;n++)for(o=0;o<2;o++)this.World.AddSprite(new i.Sparkle(this.World,16*t+8*n+(8*Math.random()|0),16*e+8*o+(8*Math.random()|0),0,0,0,2,5));return a=this.World.Level.IsBlocking(t,e,s,h),a&&h<0&&this.World.Bump(t,e,this.Large),a},i.Character2.prototype.Stomp=function(e){var s=0;this.DeathTime>0||this.World.Paused||(s=e.Y-e.Height/2,this.SubMove(0,s-this.Y),e instanceof i.Enemy||e instanceof i.BulletBill?(i.MPlayer.PlaySound("kick"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=8,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.InvulnerableTime=1):e instanceof i.Shell&&(t.KeyboardInput.IsKeyDown(t.Keys.Q)&&0===e.Facing?(this.Carried=e,e.Carried=!0):(i.MPlayer.PlaySound("kick"),this.XJumpSpeed=0,this.YJumpSpeed=-1.9,this.JumpTime=8,this.Ya=this.JumpTime*this.YJumpSpeed,this.OnGround=!1,this.Sliding=!1,this.InvulnerableTime=1)))},i.Character2.prototype.GetHurt=function(){this.DeathTime>0||this.World.Paused||this.InvulnerableTime>0||(this.Large?(this.World.Paused=!0,this.PowerUpTime=-18,i.MPlayer.PlaySound("powerdown"),this.Fire?this.SetLarge(!0,!1):this.SetLarge(!1,!1),this.InvulnerableTime=32):this.Die())},i.Character2.prototype.Win=function(){this.XDeathPos=0|this.X,this.YDeathPos=0|this.Y,this.World.Paused=!0,this.WinTime=1,i.MPlayer.PlaySound("exit")},i.Character2.prototype.Die=function(){this.XDeathPos=0|this.X,this.YDeathPos=0|this.Y,this.World.Paused=!0,this.DeathTime=1,i.MPlayer.PlaySound("death"),this.SetLarge(!1,!1)},i.Character2.prototype.GetFlower=function(){this.DeathTime>0&&this.World.Paused||(this.Fire?(this.GetCoin(),i.MPlayer.PlaySound("coin")):(this.World.Paused=!0,this.PowerUpTime=18,i.MPlayer.PlaySound("powerup"),this.SetLarge(!0,!0)))},i.Character2.prototype.GetMushroom=function(){this.DeathTime>0&&this.World.Paused||(this.Large?(this.GetCoin(),i.MPlayer.PlaySound("coin")):(this.World.Paused=!0,this.PowerUpTime=18,i.MPlayer.PlaySound("powerup"),this.SetLarge(!0,!1)))},i.Character2.prototype.Kick=function(e){this.DeathTime>0&&this.World.Paused||(t.KeyboardInput.IsKeyDown(t.Keys.Q)?(this.Carried=e,e.Carried=!0):(i.MPlayer.PlaySound("kick"),this.InvulnerableTime=1))},i.Character2.prototype.Get1Up=function(){i.MPlayer.PlaySound("1up"),99==++this.Lives&&(this.Lives=99)},i.Character2.prototype.GetCoin=function(){100==++this.Coins&&(this.Coins=0,this.Get1Up())},i.LevelRenderer=function(t,e,s){this.Width=e,this.Height=s,this.Level=t,this.Delta=0,this.Tick=0,this.Bounce=0,this.AnimTime=0,this.Background=i.SpriteCuts.GetLevelSheet(),this.FrameSize=this.Background[0][0].Width,this.FrameSizeLog=Math.log(this.FrameSize)/Math.log(2),this.TilesY=1+(s/this.FrameSize|0)},i.LevelRenderer.prototype=new t.Drawable,i.LevelRenderer.prototype.Update=function(t){this.AnimTime+=t,this.Tick=0|this.AnimTime,this.Bounce+=30*t,this.Delta=t},i.LevelRenderer.prototype.Draw=function(t,i){this.DrawStatic(t,i),this.DrawDynamic(t,i)},i.LevelRenderer.prototype.DrawStatic=function(e,s){var h=0,a=0,r=0,n=null,o=s.X/this.FrameSize|0,l=(s.X+this.Width)/this.FrameSize|0;for(h=o;h<l+1;h++)for(a=0;a<this.TilesY;a++)r=255&this.Level.GetBlock(h,a),0==(i.Tile.Behaviors[r]&i.Tile.Animated)&&(n=this.Background[r%16][r/16|0],e.drawImage(t.Resources.Images.map,n.X,n.Y,n.Width,n.Height,(h<<this.FrameSizeLog)-s.X|0,a<<this.FrameSizeLog|0,n.Width,n.Height))},i.LevelRenderer.prototype.DrawDynamic=function(e,s){var h=0,a=0,r=0,n=0,o=0,l=null,c=(s.X+this.Width)/this.FrameSize|0;for(h=s.X/this.FrameSize|0;h<=c;h++)for(a=s.Y/this.FrameSize|0;a<=(s.Y+this.Height)/this.FrameSize|0;a++)r=this.Level.GetBlock(h,a),(i.Tile.Behaviors[255&r]&i.Tile.Animated)>0&&(n=(this.Bounce/3|0)%4,0==(r%16/4|0)&&1==(r/16|0)&&(n=(this.Bounce/2+(h+a)/8|0)%20)>3&&(n=0),3==(r%16/4|0)&&0==(r/16|0)&&(n=2),o=0,h>=0&&a>=0&&h<this.Level.Width&&a<this.Level.Height&&(o=this.Level.Data[h][a]),o>0&&(o=8*Math.sin((o-this.Delta)/4*Math.PI)|0),l=this.Background[4*(r%16/4|0)+n][r/16|0],e.drawImage(t.Resources.Images.map,l.X,l.Y,l.Width,l.Height,(h<<this.FrameSizeLog)-s.X,(a<<this.FrameSizeLog)-s.Y-o,l.Width,l.Height))},i.LevelRenderer.prototype.DrawExit0=function(i,e,s){var h=0,a=0,r=null;for(h=this.Level.ExitY-8;h<this.Level.ExitY;h++)r=this.Background[12][h===this.Level.ExitY-8?4:5],i.drawImage(t.Resources.Images.map,r.X,r.Y,r.Width,r.Height,(this.Level.ExitX<<this.FrameSizeLog)-e.X-16,(h<<this.FrameSizeLog)-e.Y,r.Width,r.Height);s&&(a=16*this.Level.ExitY*n-48*n-48*Math.sin(this.AnimTime)*n-8*n,r=this.Background[12][3],i.drawImage(t.Resources.Images.map,r.X,r.Y,r.Width,r.Height,(this.Level.ExitX<<this.FrameSizeLog)-e.X-this.FrameSize,a-e.Y,r.Width,r.Height),r=this.Background[13][3],i.drawImage(t.Resources.Images.map,r.X,r.Y,r.Width,r.Height,(this.Level.ExitX<<this.FrameSizeLog)-e.X,a-e.Y,r.Width,r.Height))},i.LevelRenderer.prototype.DrawExit1=function(i,e){var s=0,h=null;for(s=this.Level.ExitY-8;s<this.Level.ExitY;s++)h=this.Background[13][s===this.Level.ExitY-8?4:5],i.drawImage(t.Resources.Images.map,h.X,h.Y,h.Width,h.Height,(this.Level.ExitX<<this.FrameSizeLog)-e.X+this.FrameSize,(s<<this.FrameSizeLog)-e.Y,h.Width,h.Height)},i.LevelGenerator=function(t,i){this.Width=200,this.Height=i},i.LevelGenerator.prototype={CreateLevel:function(){level=new i.Level(this.Width,this.Height);var t={Width:200,Height:15,ExitX:400,ExitY:7,Map:[[154,154,154,154,154,154,154,154,154,154,154,154,155,153,153],[0,0,0,0,0,0,0,0,0,0,0,0,137,153,153],[0,0,0,0,0,0,0,0,0,0,0,0,137,153,153],[0,0,0,0,0,0,0,0,0,0,0,0,137,153,153],[0,0,0,0,0,0,0,0,0,0,0,0,137,153,153],[152,152,168,0,0,0,0,0,0,0,0,0,137,153,153],[153,153,153,168,0,0,0,0,0,0,0,0,137,153,153],[153,153,153,153,168,0,0,0,0,0,0,0,137,153,153],[153,153,153,153,170,0,0,0,0,0,0,0,137,153,153],[153,153,153,170,0,0,0,0,0,0,0,0,137,153,153],[153,153,170,0,0,0,0,0,0,0,0,0,137,153,153],[153,170,0,0,0,0,0,0,0,0,0,0,137,153,153],[169,0,0,0,0,0,0,0,0,10,26,26,137,153,153],[169,0,0,0,0,0,0,0,0,11,27,27,137,153,153],[169,0,0,0,0,0,0,0,0,0,0,0,137,153,153],[169,0,0,0,0,0,0,0,0,10,26,26,137,153,153],[153,152,152,168,0,0,0,0,0,11,27,27,137,153,153],[153,153,153,153,168,0,0,0,0,0,0,0,137,153,153],[153,153,153,153,170,0,0,0,0,0,0,0,138,155,153],[153,153,153,170,0,0,0,0,0,0,0,0,0,137,153],[153,153,170,0,0,0,0,0,0,16,0,0,0,137,153],[153,170,0,0,0,0,0,0,0,21,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,16,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,16,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,21,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,21,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,16,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,21,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,16,0,34,0,137,153],[169,0,0,0,0,0,0,0,0,0,0,0,0,137,153],[153,168,0,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,168,0,0,0,0,0,0,17,0,34,0,137,153],[153,153,169,0,0,0,0,0,0,16,0,34,0,137,153],[153,153,169,0,0,0,0,0,0,21,0,34,0,137,153],[153,153,169,0,0,0,0,0,0,21,0,34,0,137,153],[153,153,169,0,0,0,0,0,0,16,0,34,0,137,153],[153,153,169,0,0,0,0,0,0,16,0,34,0,137,153],[153,153,169,0,0,0,0,0,0,16,0,34,0,137,153],[171,171,170,0,0,0,0,0,0,0,0,0,0,137,153],[171,170,0,0,0,0,0,0,0,0,0,0,136,155,153],[169,0,0,0,0,0,0,0,0,0,0,136,155,155,155],[169,0,0,0,0,0,16,0,34,0,136,155,155,155,155],[169,0,0,0,0,0,16,0,34,0,137,155,155,155,155],[169,0,0,0,0,0,21,0,34,0,137,155,154,155,155],[153,168,0,0,0,0,16,0,34,0,137,169,0,138,155],[153,153,168,0,0,0,16,0,34,0,137,169,0,0,137],[153,153,153,168,0,0,16,0,34,0,137,169,0,136,155],[153,153,153,169,0,0,21,0,34,0,137,155,152,155,155],[153,171,171,170,0,0,16,0,34,0,137,155,155,155,155],[171,171,170,0,0,0,16,0,34,0,138,155,155,155,155],[171,170,0,0,0,0,0,0,0,0,0,138,155,155,155],[169,0,0,0,0,0,0,0,0,0,0,0,138,155,155],[169,0,0,0,0,0,0,0,0,0,0,0,0,137,139],[169,0,0,0,0,0,0,0,0,0,0,0,0,137,153],[169,0,0,0,0,0,0,0,0,0,0,0,9,137,153],[169,0,0,0,0,0,0,0,0,0,0,9,9,138,154],[187,168,0,0,0,0,0,0,0,0,0,0,0,0,0],[153,153,168,0,0,0,0,0,0,0,0,0,0,0,0],[153,153,169,0,0,0,0,0,0,0,0,9,9,136,152],[153,153,169,0,0,0,0,0,0,0,0,0,9,137,153],[153,154,153,168,0,0,0,0,0,0,0,0,0,137,153],[169,0,137,169,0,0,0,0,0,0,0,0,0,137,153],[169,0,137,169,0,0,0,0,0,0,0,136,152,139,153],[153,152,153,169,0,0,0,0,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,34,0,137,153,153,153],[153,153,153,170,0,0,0,0,0,34,0,137,153,153,153],[153,153,170,0,0,0,0,0,0,34,0,137,153,153,153],[171,170,0,0,0,0,0,0,0,0,0,138,153,153,155],[169,0,0,0,0,0,0,0,0,0,0,0,138,153,153],[169,0,0,0,0,0,0,0,16,0,0,0,34,137,153],[169,0,0,0,0,0,0,0,21,0,0,0,34,137,153],[169,0,0,0,0,0,0,0,16,0,0,0,34,137,153],[169,0,0,0,0,0,0,0,21,0,0,0,34,137,153],[169,0,0,0,0,0,0,0,16,0,0,0,34,137,153],[187,168,0,0,0,0,0,0,16,0,0,0,34,137,153],[187,187,168,0,0,0,0,0,0,0,0,0,136,153,153],[153,187,187,168,0,0,0,0,0,0,0,136,153,153,139],[153,153,153,169,0,0,0,16,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,21,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,21,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,21,0,34,0,137,153,153,153],[153,153,153,169,0,0,0,16,0,34,0,137,153,153,153],[153,153,171,170,0,0,0,0,0,0,0,137,153,153,153],[153,153,169,0,0,0,0,0,0,0,0,137,153,153,153],[153,153,169,0,0,0,0,16,0,0,0,137,153,153,153],[153,153,169,0,0,0,0,16,0,0,0,137,153,153,153],[153,153,169,0,0,0,0,16,0,0,0,137,153,153,153],[153,153,169,0,0,0,0,17,0,34,0,137,153,153,153],[153,153,187,168,0,0,0,16,0,34,0,137,153,153,153],[153,153,153,169,0,0,0,16,0,34,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,34,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,34,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,0,0,138,155,153,153],[153,153,153,169,0,0,0,0,0,0,0,0,137,153,153],[153,153,153,169,0,0,0,0,0,0,0,0,137,153,153],[153,153,153,169,0,0,0,0,0,0,0,0,137,153,153],[153,153,153,169,0,0,0,0,0,10,26,26,137,153,153],[153,153,153,169,0,0,0,0,0,11,27,27,137,153,153],[153,153,153,169,0,0,0,0,0,0,0,0,137,153,153],[153,153,153,169,0,0,0,0,0,0,0,136,139,153,153],[153,171,154,170,0,0,0,0,0,0,0,137,153,153,153],[153,169,0,0,0,0,0,0,0,0,0,138,155,153,153],[153,169,0,0,0,0,0,0,0,0,0,0,137,153,153],[153,169,0,0,0,0,0,0,0,0,34,0,137,153,153],[153,169,0,0,0,0,0,0,0,0,34,0,137,153,153],[153,169,0,0,0,0,0,0,0,0,34,0,137,153,153],[171,170,0,0,0,0,0,0,21,0,34,0,137,153,153],[169,0,0,0,0,0,0,0,21,0,34,0,137,153,153],[169,0,0,0,0,0,0,0,16,0,34,0,137,153,153],[169,0,0,0,0,0,0,0,16,0,34,0,137,153,153],[169,0,0,0,0,0,0,0,0,0,0,0,137,153,153],[153,168,0,0,0,0,0,0,0,0,0,0,137,153,153],[153,153,168,0,0,0,0,0,0,0,0,136,139,153,153],[153,153,153,168,0,0,0,0,0,0,0,137,153,153,153],[153,153,153,169,0,0,0,0,0,0,9,137,153,153,153],[153,153,153,169,0,0,0,0,0,9,9,137,153,153,153],[153,153,153,169,0,0,0,0,9,9,9,138,154,154,154],[171,154,154,170,0,0,0,0,0,0,0,0,0,0,0],[169,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[169,0,0,0,0,0,0,0,9,9,9,136,152,152,152],[169,0,0,0,0,0,0,0,0,9,9,137,153,153,153],[169,0,0,0,0,0,0,0,0,0,9,137,153,153,153],[169,0,0,0,0,0,0,0,0,0,0,137,153,153,153],[169,0,0,0,0,0,0,0,0,0,0,138,155,153,153],[169,0,0,0,0,0,0,0,0,0,0,0,137,153,153],[187,152,152,152,168,0,0,0,0,0,0,0,137,153,153],[153,154,154,153,153,168,0,0,0,0,0,0,137,153,153],[169,0,0,138,154,153,168,0,0,0,0,0,137,153,153],[153,168,0,0,22,137,169,0,0,0,0,0,138,154,155],[153,153,168,0,0,137,169,0,0,0,0,0,0,0,137],[153,153,153,168,0,137,169,0,0,0,0,0,0,0,137],[153,153,153,153,152,153,170,0,0,0,0,0,0,0,137],[153,153,153,153,154,170,0,0,0,0,0,0,0,0,137],[153,153,153,170,0,0,0,0,0,0,0,0,0,0,137],[153,154,170,0,0,0,0,0,0,0,0,0,0,0,137],[169,0,0,0,0,0,0,0,0,0,0,0,0,136,139],[169,0,0,0,0,0,0,0,0,0,0,0,136,153,153],[169,0,0,0,0,0,0,0,0,0,0,136,153,153,153],[169,0,0,0,0,0,0,0,0,0,0,138,153,153,153],[169,0,0,0,16,0,0,0,34,0,0,0,138,153,153],[169,0,0,16,16,16,0,0,0,34,0,0,0,137,153],[169,0,16,16,16,16,16,0,0,0,34,0,0,137,153],[169,0,0,16,16,16,16,16,0,0,0,34,0,137,153],[169,0,0,0,16,16,16,16,16,0,0,0,34,137,153],[169,0,0,16,16,16,16,16,0,0,0,34,0,137,153],[169,0,16,16,16,16,16,0,0,0,34,0,0,137,153],[169,0,0,16,16,16,0,0,0,34,0,0,0,137,153],[169,0,0,0,16,0,0,0,34,0,0,0,136,153,153],[169,0,0,0,0,0,0,0,0,0,0,136,153,153,153],[169,0,0,0,0,0,0,22,0,0,0,138,153,153,153],[169,0,0,0,0,0,0,0,0,0,0,0,138,154,154],[169,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[169,0,0,0,0,0,0,0,0,0,0,0,136,152,152],[169,0,0,0,0,0,0,0,0,0,0,0,138,154,154],[169,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[169,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[169,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[169,0,0,0,0,0,0,0,0,0,0,0,136,152,152],[187,168,0,0,0,0,0,0,0,0,0,0,138,154,154],[153,169,0,0,0,0,0,0,0,0,0,0,0,0,0],[153,169,0,0,0,0,0,0,0,0,0,0,0,0,0],[153,169,0,0,0,0,0,0,0,0,136,152,152,152,152],[153,169,0,0,0,0,0,0,0,0,138,154,154,153,153],[153,169,0,0,0,0,0,0,0,0,0,0,0,137,153],[153,169,0,0,0,0,0,0,0,0,0,0,0,137,153],[153,169,0,0,0,0,0,0,0,22,0,0,0,137,153],[153,187,152,168,0,0,0,0,0,0,0,0,0,137,153],[153,153,153,169,0,0,0,0,0,0,0,0,0,138,153],[153,153,153,169,0,0,0,0,0,0,0,0,0,0,137],[153,153,153,169,0,0,0,0,0,0,0,0,0,0,137],[153,153,153,169,0,0,0,0,0,0,0,0,0,136,153],[153,153,171,170,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,187,168,0,0,0,0,0,0,0,0,0,137,153],[153,153,153,169,0,0,0,0,0,0,0,0,0,137,153],[153,153,153,169,0,0,0,0,0,0,0,0,0,137,153],[153,153,153,169,0,0,0,0,0,0,0,0,0,137,153],[153,153,153,169,0,0,0,0,0,0,0,0,0,137,153],[153,153,171,170,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,169,0,0,0,0,0,0,0,0,0,0,137,153],[153,171,170,0,0,0,0,0,0,0,0,0,0,137,153],[153,169,0,0,0,0,0,0,0,0,0,0,10,137,153],[153,169,0,0,0,0,0,0,0,0,0,0,11,137,153],[153,169,0,0,0,0,0,0,0,0,0,0,0,137,153],[153,169,0,0,0,0,0,0,0,0,0,0,0,137,153],[153,153,152,152,152,152,152,152,152,152,152,152,152,153,153],[153,153,153,153,153,153,153,153,153,153,153,153,153,153,153]],SpriteTemplates:{Width:200,Height:15,Enemies:[{X:19,Y:10,Type:2,Winged:!1},{X:33,Y:10,Type:0,Winged:!1},{X:36,Y:10,Type:1,Winged:!1},{X:39,Y:10,Type:0,Winged:!1},{X:56,Y:10,Type:2,Winged:!1},{X:60,Y:10,Type:2,Winged:!1},{X:61,Y:10,Type:2,Winged:!1},{X:73,Y:10,Type:2,Winged:!1},{X:75,Y:10,Type:1,Winged:!1},{X:83,Y:10,Type:1,Winged:!1},{X:114,Y:10,Type:2,Winged:!1},{X:135,Y:10,Type:2,Winged:!1},{X:136,Y:10,Type:1,Winged:!1},{X:146,Y:10,Type:1,Winged:!1}]}};return e(level,t,{SpriteTemplates:h}),level}},i.SpriteTemplate=function(t,i){this.Type=t,this.Winged=i,this.LastVisibleTick=-1,this.IsDead=!1,this.Sprite=null},i.SpriteTemplate.prototype={Spawn:function(t,e,s,h){this.IsDead||(this.Type===i.Enemy.Flower?this.Sprite=new i.FlowerEnemy(t,16*e+15,16*s+24):this.Sprite=new i.Enemy(t,16*e+8,16*s+15,h,this.Type,this.Winged),this.Sprite.SpriteTemplate=this,t.AddSprite(this.Sprite))}},i.Enemy=function(e,s,h,a,r,o){this.GroundInertia=.89,this.AirInertia=.89,this.RunTime=0,this.OnGround=!1,this.MayJump=!1,this.JumpTime=0,this.XJumpSpeed=0,this.YJumpSpeed=0,this.Width=4,this.Height=24,this.DeadTime=0,this.FlyDeath=!1,this.WingTime=0,this.NoFireballDeath=!1,this.X=s,this.Y=h,this.World=e,this.Type=r,this.Winged=o,this.Image=t.Resources.Images.enemies,this.XPicO=8,this.YPicO=31,this.AvoidCliffs=this.Type===i.Enemy.RedKoopa,this.NoFireballDeath=this.Type===i.Enemy.Spiky,this.YPic=this.Type,this.YPic>1&&(this.Height=12),this.Facing=a,0===this.Facing&&(this.Facing=1),this.PicWidth=16*n,this.PicHeight=32*n},i.Enemy.prototype=new i.NotchSprite,i.Enemy.prototype.CollideCheck=function(){if(0===this.DeadTime){var t=i.MarioCharacter.X-this.X,e=i.MarioCharacter.Y-this.Y;t>2*-this.Width-4&&t<2*this.Width+4&&e>-this.Height&&e<i.MarioCharacter.Height&&(!(this.Type!==i.Enemy.Spiky&&i.MarioCharacter.Ya>0&&e<=0)||i.MarioCharacter.OnGround&&i.MarioCharacter.WasOnGround?i.MarioCharacter.GetHurt():(i.MarioCharacter.Stomp(this),this.Winged?(this.Winged=!1,this.Ya=0):(this.YPicO=7,this.PicHeight=8*n,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=10,this.Winged=!1,this.Type===i.Enemy.RedKoopa?this.World.AddSprite(new i.Shell(this.World,this.X,this.Y,0)):this.Type===i.Enemy.GreenKoopa&&this.World.AddSprite(new i.Shell(this.World,this.X,this.Y,1)))))}},i.Enemy.prototype.Move=function(){var t=0,e=0;if(this.WingTime++,this.DeadTime>0){if(0==--this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new i.Sparkle(this.World,4+(this.X+16*Math.random()-8|0),4+(this.Y-8*Math.random()|0),2*Math.random()-1,Math.random()*-1,0,1,5));this.World.RemoveSprite(this)}return void(this.FlyDeath&&(this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,this.Ya+=1))}this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=1.75*this.Facing,this.MayJump=this.OnGround,this.XFlip=this.Facing===-1,this.RunTime+=Math.abs(this.Xa)+5,e=(this.RunTime/20|0)%2,this.OnGround||(e=1),this.SubMove(this.Xa,0)||(this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=this.Winged?.95:.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround?this.Winged&&(this.Ya=-10):this.Winged?this.Ya+=.6:this.Ya+=2,this.Winged&&(e=(this.WingTime/4|0)%2),this.XPic=e},i.Enemy.prototype.SubMove=function(t,i){for(var e=!1;t>8;){
if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;i>8;){if(!this.SubMove(0,8))return!1;i-=8}for(;i<-8;){if(!this.SubMove(0,-8))return!1;i+=8}return i>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t-this.Width,this.Y+i+1,t,i)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i+1,t,i)&&(e=!0)),i<0&&(this.IsBlocking(this.X+t,this.Y+i-this.Height,t,i)?e=!0:e||this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:(e||this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i))&&(e=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i,t,i)&&(e=!0),this.AvoidCliffs&&this.OnGround&&!this.World.Level.IsBlocking((this.X+this.Xa+this.Width)/16|0,this.Y/16+1|0,this.Xa,1)&&(e=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i,t,i)&&(e=!0),this.AvoidCliffs&&this.OnGround&&!this.World.Level.IsBlocking((this.X+this.Xa-this.Width)/16|0,this.Y/16+1|0,this.Xa,1)&&(e=!0)),e?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),i<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),i>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=i,!0)},i.Enemy.prototype.IsBlocking=function(t,i,e,s){return t=t/16|0,i=i/16|0,!(t===this.X/16|0&&i===this.Y/16|0)&&this.World.Level.IsBlocking(t,i,e,s)},i.Enemy.prototype.ShellCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,s=t.Y-this.Y;return e>-16&&e<16&&s>-this.Height&&s<t.Height&&(i.MPlayer.PlaySound("kick"),this.Xa=2*t.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0,!0)},i.Enemy.prototype.FireballCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,s=t.Y-this.Y;return e>-16&&e<16&&s>-this.Height&&s<t.Height?!!this.NoFireballDeath||(i.MPlayer.PlaySound("kick"),this.Xa=2*t.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0,!0):void 0},i.Enemy.prototype.BumpCheck=function(t,e){0===this.DeadTime&&this.X+this.Width>16*t&&this.X-this.Width<16*t+16&&e===(this.Y-1)/16|0&&(i.MPlayer.PlaySound("kick"),this.Xa=2*-i.MarioCharacter.Facing,this.Ya=-5,this.FlyDeath=!0,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.Winged=!1,this.YFlip=!0)},i.Enemy.prototype.SubDraw=i.NotchSprite.prototype.Draw,i.Enemy.prototype.Draw=function(t,e){var s=0,h=0;this.Winged&&(s=n*((this.XOld+(this.X-this.XOld)*this.Delta|0)-this.XPicO),h=n*((this.YOld+(this.Y-this.YOld)*this.Delta|0)-this.YPicO),this.Type!==i.Enemy.RedKoopa&&this.Type!==i.Enemy.GreenKoopa&&(this.XFlip=!this.XFlip,t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-a:0,this.YFlip?-r:0),t.drawImage(this.Image,(this.WingTime/4|0)%2*16*n,128*n,16*n,32*n,this.XFlip?a-s-24*n:s-8*n,this.YFlip?r-h-32*n:h-8*n,16*n,32*n),t.restore(),this.XFlip=!this.XFlip)),this.SubDraw(t,e),this.Winged&&(s=n*((this.XOld+(this.X-this.XOld)*this.Delta|0)-this.XPicO),h=n*((this.YOld+(this.Y-this.YOld)*this.Delta|0)-this.YPicO),this.Type===i.Enemy.RedKoopa||this.Type===i.Enemy.GreenKoopa?(t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-a:0,this.YFlip?-r:0),t.drawImage(this.Image,(this.WingTime/4|0)%2*16*n,128*n,16*n,32*n,this.XFlip?a-s-24*n:s-8*n,this.YFlip?r-h:h-8*n,16*n,32*n),t.restore()):(t.save(),t.scale(this.XFlip?-1:1,this.YFlip?-1:1),t.translate(this.XFlip?-a:0,this.YFlip?-r:0),t.drawImage(this.Image,(this.WingTime/4|0)%2*16*n,128*n,16*n,32*n,this.XFlip?a-s-24*n:s-8*n,this.YFlip?r-h-32*n:h-8*n,16*n,32*n),t.restore()))},i.Enemy.RedKoopa=0,i.Enemy.GreenKoopa=1,i.Enemy.Goomba=2,i.Enemy.Spiky=3,i.Enemy.Flower=4,i.Fireball=function(i,e,s,h){this.GroundInertia=.89,this.AirInertia=.89,this.Image=t.Resources.Images.particles,this.World=i,this.X=e,this.Y=s,this.Facing=h,this.XPicO=4,this.YPicO=4,this.YPic=3,this.XPic=4,this.Height=8,this.Width=4,this.PicWidth=this.PicHeight=8*n,this.Ya=4,this.Dead=!1,this.DeadTime=0,this.Anim=0,this.OnGround=!1},i.Fireball.prototype=new i.NotchSprite,i.Fireball.prototype.Move=function(){var t=0;if(this.DeadTime>0){for(t=0;t<8;t++)this.World.AddSprite(new i.Sparkle(this.World,4+(this.X+8*Math.random()-4|0),2+(this.Y+8*Math.random()-4|0),2*Math.random()-1*this.Facing,2*Math.random()-1,0,1,5));return void this.World.RemoveSprite(this)}0!=this.Facing&&this.Anim++,this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=8*this.Facing,this.World.CheckFireballCollide(this),this.FlipX=this.Facing===-1,this.XPic=this.Anim%4,this.SubMove(this.Xa,0)||this.Die(),this.OnGround=!1,this.SubMove(0,this.Ya),this.OnGround&&(this.Ya=-10),this.Ya*=.95,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=1.5)},i.Fireball.prototype.SubMove=function(t,i){for(var e=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;i>8;){if(!this.SubMove(0,8))return!1;i-=8}for(;i<-8;){if(!this.SubMove(0,-8))return!1;i+=8}return i>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t-this.Width,this.Y+i+1,t,i)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i+1,t,i)&&(e=!0)),i<0&&(this.IsBlocking(this.X+t,this.Y+i-this.Height,t,i)?e=!0:e||this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:(e||this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i))&&(e=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i,t,i)&&(e=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i,t,i)&&(e=!0)),e?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),i<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.Ya=0),i>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=i,!0)},i.Fireball.prototype.IsBlocking=function(t,i,e,s){return t=t/16|0,i=i/16|0,!(t===this.X/16|0&&i===this.Y/16|0)&&this.World.Level.IsBlocking(t,i,e,s)},i.Fireball.prototype.Die=function(){this.Dead=!0,this.Xa=2*-this.Facing,this.Ya=-5,this.DeadTime=100},i.Sparkle=function(i,e,s,h,a){this.World=i,this.X=e,this.Y=s,this.Xa=h,this.Ya=a,this.XPic=2*Math.random()|0,this.YPic=0,this.Life=10+(5*Math.random()|0),this.XPicStart=this.XPic,this.XPicO=4,this.YPicO=4,this.PicWidth=8*n,this.PicHeight=8*n,this.Image=t.Resources.Images.particles},i.Sparkle.prototype=new i.NotchSprite,i.Sparkle.prototype.Move=function(){this.Life>10?this.XPic=7:this.XPic=this.XPicStart+.4*(10-this.Life)|0,this.Life--<0&&this.World.RemoveSprite(this),this.X+=this.Xa,this.Y+=this.Ya},i.CoinAnim=function(i,e,s){this.World=i,this.Life=10,this.Image=t.Resources.Images.map,this.PicWidth=this.PicHeight=16*n,this.X=16*e,this.Y=16*s-16,this.Xa=0,this.Ya=-6,this.XPic=0,this.YPic=2},i.CoinAnim.prototype=new i.NotchSprite,i.CoinAnim.prototype.Move=function(){var t=0,e=0;if(this.Life--<0)for(this.World.RemoveSprite(this),t=0;t<2;t++)for(e=0;e<2;e++)this.World.AddSprite(new i.Sparkle(this.World,this.X+8*t+8*Math.random()|0,this.Y+8*e+8*Math.random()|0,0,0,0,2,5));this.XPic=3&this.Life,this.X+=this.Xa,this.Y+=this.Ya,this.Ya+=1},i.RingAnim=function(i,e,s){this.Width=4,this.Height=24,this.World=i,this.X=e,this.Y=s,this.Image=t.Resources.Images.ring,this.XPicO=8,this.YPicO=15,this.XPic=0,this.YPic=0,this.Height=12,this.Facing=1,this.PicWidth=this.PicHeight=16*n,this.Life=0},i.RingAnim.prototype=new i.NotchSprite,i.RingAnim.prototype.CollideCheck=function(){var t=i.MarioCharacter.X-this.X,e=i.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<i.MarioCharacter.Height&&(i.MarioCharacter.GetFlower(),this.World.RemoveSprite(this))},i.RingAnim.prototype.Move=function(){this.Life<9&&(this.Layer=0,this.Y--),this.Life++,this.XPic=this.Life%40/5|0},i.Mushroom=function(i,e,s){this.RunTime=0,this.GroundInertia=.89,this.AirInertia=.89,this.OnGround=!1,this.Width=4,this.Height=24,this.World=i,this.X=e,this.Y=s,this.Image=t.Resources.Images.items,this.XPicO=8,this.YPicO=15,this.YPic=0,this.Height=12,this.Facing=1,this.PicWidth=this.PicHeight=16*n,this.Life=0},i.Mushroom.prototype=new i.NotchSprite,i.Mushroom.prototype.CollideCheck=function(){var t=i.MarioCharacter.X-this.X,e=i.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<i.MarioCharacter.Height&&(i.MarioCharacter.GetMushroom(),this.World.RemoveSprite(this))},i.Mushroom.prototype.Move=function(){if(this.Life<9)return this.Layer=0,this.Y--,void this.Life++;this.Layer=1,this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=1.75*this.Facing,this.XFlip=this.Facing===-1,this.RunTime+=Math.abs(this.Xa)+5,this.SubMove(this.Xa,0)||(this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=2)},i.Mushroom.prototype.SubMove=function(t,i){for(var e=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;i>8;){if(!this.SubMove(0,8))return!1;i-=8}for(;i<-8;){if(!this.SubMove(0,-8))return!1;i+=8}return i>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t-this.Width,this.Y+i+1,t,i)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i+1,t,i)&&(e=!0)),i<0&&(this.IsBlocking(this.X+t,this.Y+i-this.Height,t,i)?e=!0:e||this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:(e||this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i))&&(e=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i,t,i)&&(e=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i,t,i)&&(e=!0)),e?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),i<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.JumpTime=0,this.Ya=0),i>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=i,!0)},i.Mushroom.prototype.IsBlocking=function(t,i,e,s){return t=t/16|0,i=i/16|0,!(t===this.X/16|0&&i===this.Y/16|0)&&this.World.Level.IsBlocking(t,i,e,s)},i.Mushroom.prototype.BumpCheck=function(t,e){this.X+this.Width>16*t&&this.X-this.Width<16*t-16&&e===(e-1)/16|0&&(this.Facing=-i.MarioCharacter.Facing,this.Ya=-10)},i.Particle=function(i,e,s,h,a){this.World=i,this.X=e,this.Y=s,this.Xa=h,this.Ya=a,this.XPic=2*Math.random()|0,this.YPic=0,this.XPicO=4,this.YPicO=4,this.PicWidth=8*n,this.PicHeight=8*n,this.Life=10,this.Image=t.Resources.Images.particles},i.Particle.prototype=new i.NotchSprite,i.Particle.prototype.Move=function(){this.Life-this.Delta<0&&this.World.RemoveSprite(this),this.Life-=this.Delta,this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,this.Ya+=3},i.FireFlower=function(i,e,s){this.Width=4,this.Height=24,this.World=i,this.X=e,this.Y=s,this.Image=t.Resources.Images.items,this.XPicO=8,this.YPicO=15,this.XPic=1,this.YPic=0,this.Height=12,this.Facing=1,this.PicWidth=this.PicHeight=16*n,this.Life=0},i.FireFlower.prototype=new i.NotchSprite,i.FireFlower.prototype.CollideCheck=function(){var t=i.MarioCharacter.X-this.X,e=i.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<i.MarioCharacter.Height&&(i.MarioCharacter.GetFlower(),this.World.RemoveSprite(this))},i.FireFlower.prototype.Move=function(){if(this.Life<9)return this.Layer=0,this.Y--,void this.Life++},i.BulletBill=function(i,e,s,h){this.Image=t.Resources.Images.enemies,this.World=i,this.X=e,this.Y=s,this.Facing=h,this.XPicO=8,this.YPicO=31,this.Height=12,this.Width=4,this.PicWidth=16*n,this.YPic=5,this.XPic=0,this.Ya=-5,this.DeadTime=0,this.Dead=!1,this.Anim=0},i.BulletBill.prototype=new i.NotchSprite,i.BulletBill.prototype.CollideCheck=function(){if(!this.Dead){var t=i.MarioCharacter.X-this.X,e=i.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<this.World.Mario.Height&&(!(i.MarioCharacter.Y>0&&e<=0)||i.MarioCharacter.OnGround&&i.MarioCharacter.WasOnGround?i.MarioCharacter.GetHurt():(i.MarioCharacter.Stomp(this),this.Dead=!0,this.Xa=0,this.Ya=1,this.DeadTime=100))}},i.BulletBill.prototype.Move=function(){var t=0;if(this.DeadTime>0){if(0==--this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new i.Sparkle(4+(this.X+16*Math.random()-8|0),4+(this.Y+8*Math.random()|0),2*Math.random()-1,Math.random()*-1,0,1,5));this.World.RemoveSprite(this)}return this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,void(this.Ya+=1)}this.Xa=4*this.Facing,this.XFlip=this.Facing===-1,this.Move(this.Xa,0)},i.BulletBill.prototype.SubMove=function(t){return this.X+=t,!0},i.BulletBill.prototype.FireballCollideCheck=function(t){if(0!==this.DeadTime)return!1;var i=t.X-this.X,e=t.Y-this.Y;return i>-16&&i<16&&e>-this.Height&&e<t.Height},i.BulletBill.prototype.ShellCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,s=t.Y-this.Y;return e>-16&&e<16&&s>-this.Height&&s<t.Height&&(i.MPlayer.PlaySound("kick"),this.Dead=!0,this.Xa=0,this.Ya=1,this.DeadTime=100,!0)},i.FlowerEnemy=function(e,s,h){this.Image=t.Resources.Images.enemies,this.World=e,this.X=s,this.Y=h,this.Facing=1,this.Type=i.Enemy.Spiky,this.Winged=!1,this.NoFireballDeath=!1,this.XPic=0,this.YPic=6,this.YPicO=24,this.Height=12,this.Width=2,this.YStart=h,this.Ya=-8,this.Y-=1,this.Layer=0,this.JumpTime=0,this.Tick=0;var a=0;for(a=0;a<4;a++)this.Move()},i.FlowerEnemy.prototype=new i.Enemy,i.FlowerEnemy.prototype.Move=function(){var t=0,e=0;if(this.DeadTime>0){if(0==--this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new i.Sparkle(4+(this.X+16*Math.random()-8|0),4+(this.Y+8*Math.random()|0),2*Math.random()-1,Math.random()*-1,0,1,5));this.World.RemoveSprite(this)}return this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,void(this.Ya+=1)}this.Tick++,this.Y>=this.YStart?(this.YStart=this.Y,e=0|Math.abs(i.MarioCharacter.X-this.X),this.JumpTime++,this.JumpTime>40&&e>24?this.Ya=-8:this.Ya=0):this.JumpTime=0,this.Y+=this.Ya,this.Ya*=.9,this.Ya+=.1,this.XPic=2*(1&(this.Tick/2|0))+(1&(this.Tick/6|0))},i.Shell=function(i,e,s,h){this.World=i,this.X=e,this.Y=s,this.YPic=h,this.Image=t.Resources.Images.enemies,this.XPicO=8,this.YPicO=31,this.Width=4,this.Height=12,this.Facing=0,this.PicWidth=16*n,this.PicHeight=32*n,this.XPic=4,this.Ya=-5,this.Dead=!1,this.DeadTime=0,this.Carried=!1,this.GroundInertia=.89,this.AirInertia=.89,this.OnGround=!1,this.Anim=0},i.Shell.prototype=new i.NotchSprite,i.Shell.prototype.FireballCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,s=t.Y-this.Y;return e>-16&&e<16&&s>-this.Height&&s<t.Height&&(0!==this.Facing||(i.MPlayer.PlaySound("kick"),this.Xa=2*t.Facing,this.Ya=-5,null!==this.SpriteTemplate&&(this.SpriteTemplate.IsDead=!0),this.DeadTime=100,this.YFlip=!0,!0))},i.Shell.prototype.CollideCheck=function(){if(!(this.Carried||this.Dead||this.DeadTime>0)){var t=i.MarioCharacter.X-this.X,e=i.MarioCharacter.Y-this.Y;t>-16&&t<16&&e>-this.Height&&e<i.MarioCharacter.Height&&(!(i.MarioCharacter.Ya>0&&e<=0)||i.MarioCharacter.OnGround&&i.MarioCharacter.WasOnGround?0!==this.Facing?i.MarioCharacter.GetHurt():(i.MarioCharacter.Kick(this),this.Facing=i.MarioCharacter.Facing):(i.MarioCharacter.Stomp(this),0!==this.Facing?(this.Xa=0,this.Facing=0):this.Facing=i.MarioCharacter.Facing))}},i.Shell.prototype.Move=function(){var t=0;if(this.Carried)return void this.World.CheckShellCollide(this);if(this.DeadTime>0){if(0==--this.DeadTime){for(this.DeadTime=1,t=0;t<8;t++)this.World.AddSprite(new i.Sparkle(4+(this.X+16*Math.random()-8|0),4+(this.Y+8*Math.random()|0),2*Math.random()-1,Math.random()*-1,0,1,5));this.World.RemoveSprite(this)}return this.X+=this.Xa,this.Y+=this.Ya,this.Ya*=.95,void(this.Ya+=1)}0!==this.Facing&&this.Anim++,this.Xa>2&&(this.Facing=1),this.Xa<-2&&(this.Facing=-1),this.Xa=11*this.Facing,0!==this.Facing&&this.World.CheckShellCollide(this),this.XFlip=this.Facing===-1,this.XPic=(this.Anim/2|0)%4+3,this.SubMove(this.Xa,0)||(i.MPlayer.PlaySound("bump"),this.Facing=-this.Facing),this.OnGround=!1,this.SubMove(0,this.Ya),this.Ya*=.85,this.OnGround?this.Xa*=this.GroundInertia:this.Xa*=this.AirInertia,this.OnGround||(this.Ya+=2)},i.Shell.prototype.SubMove=function(t,i){for(var e=!1;t>8;){if(!this.SubMove(8,0))return!1;t-=8}for(;t<-8;){if(!this.SubMove(-8,0))return!1;t+=8}for(;i>8;){if(!this.SubMove(0,8))return!1;i-=8}for(;i<-8;){if(!this.SubMove(0,-8))return!1;i+=8}return i>0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i,t,0)?e=!0:this.IsBlocking(this.X+t-this.Width,this.Y+i+1,t,i)?e=!0:this.IsBlocking(this.X+t+this.Width,this.Y+i+1,t,i)&&(e=!0)),i<0&&(this.IsBlocking(this.X+t,this.Y+i-this.Height,t,i)?e=!0:e||this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)?e=!0:(e||this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i))&&(e=!0)),t>0&&(this.IsBlocking(this.X+t+this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t+this.Width,this.Y+i,t,i)&&(e=!0)),t<0&&(this.IsBlocking(this.X+t-this.Width,this.Y+i-this.Height,t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i-(this.Height/2|0),t,i)&&(e=!0),this.IsBlocking(this.X+t-this.Width,this.Y+i,t,i)&&(e=!0)),e?(t<0&&(this.X=16*((this.X-this.Width)/16|0)+this.Width,this.Xa=0),t>0&&(this.X=16*((this.X+this.Width)/16+1|0)-this.Width-1,this.Xa=0),i<0&&(this.Y=16*((this.Y-this.Height)/16|0)+this.Height,this.Ya=0),i>0&&(this.Y=16*((this.Y-1)/16+1|0)-1,this.OnGround=!0),!1):(this.X+=t,this.Y+=i,!0)},i.Shell.prototype.IsBlocking=function(t,i,e,s){if(t=t/16|0,i=i/16|0,t===(this.X/16|0)&&i===(this.Y/16|0))return!1;var h=this.World.Level.IsBlocking(t,i,e,s);return h&&0===s&&0!==e&&this.World.Bump(t,i,!0),h},i.Shell.prototype.BumpCheck=function(t,e){this.X+this.Width>16*t&&this.X-this.Width<16*t+16&&e===((this.Y-1)/16|0)&&(this.Facing=-i.MarioCharacter.Facing,this.Ya=-10)},i.Shell.prototype.Die=function(){this.Dead=!0,this.Carried=!1,this.Xa=2*-this.Facing,this.Ya=-5,this.DeadTime=100},i.Shell.prototype.ShellCollideCheck=function(t){if(0!==this.DeadTime)return!1;var e=t.X-this.X,s=t.Y-this.Y;return e>-16&&e<16&&s>-this.Height&&s<t.Height&&(i.MPlayer.PlaySound("kick"),i.MarioCharacter.Carried!==t&&i.MarioCharacter.Carried!==this||(i.MarioCharacter.Carried=null),this.Die(),t.Die(),!0)},i.Shell.prototype.Release=function(){this.Carried=!1,this.Facing=i.MarioCharacter.Facing,this.X+=8*this.Facing},i.IntroState=function(){this.camera=null,this.fontw=null,this.fontb=null,this.changeState=!1,this.DoOpen=!0,this.Time=0,this.canChangeState=!1,this.message=[],this.message[0]="In every fairytale ",this.message[1]="there is a Super Hero, ",this.message[2]="searching for his Princess... ",this.messageLen=[],this.messageLen[0]=this.message[0].length,this.messageLen[1]=this.message[1].length,this.messageLen[2]=this.message[2].length,t.MouseInput.Reset()},i.IntroState.prototype=new t.GameState,i.IntroState.prototype.Enter=function(){this.camera=new t.Camera,this.title=new t.Sprite,this.title.Image=t.Resources.Images.title,this.title.X=0,this.title.Y=120*n,this.logo=new t.Sprite,this.logo.Image=t.Resources.Images.logo,this.logo.X=0,this.logo.Y=0,this.fontb=i.SpriteCuts.CreateBlackFont(),this.fontb.Strings[0]={String:"_",X:0,Y:r/2-128},this.fontb.Strings[1]={String:"",X:0,Y:r/2-64},this.fontb.Strings[2]={String:"",X:0,Y:r/2-0}},i.IntroState.prototype.Exit=function(){delete this.camera,delete this.font},i.IntroState.prototype.Update=function(){if(this.Time+=5,this.Time<600)this.Time%100<70?this.fontb.Strings[0].String="_":this.fontb.Strings[0].String="";else{this.DoOpen=!1;var t=(this.Time-600)/10|0;t<this.messageLen[0]?this.fontb.Strings[0].String=this.message[0].substring(0,t):t<this.messageLen[0]+this.messageLen[1]?this.fontb.Strings[1].String=this.message[1].substring(0,t-this.messageLen[0]):t<this.messageLen[0]+this.messageLen[1]+this.messageLen[2]?this.fontb.Strings[2].String=this.message[2].substring(0,t-this.messageLen[0]-this.messageLen[1]):t>this.messageLen[0]+this.messageLen[1]+this.messageLen[2]+30&&(this.canChangeState=!0)}},i.IntroState.prototype.Draw=function(i){if(i.drawImage(t.Resources.Images.paper,0,0,a,r),this.fontb.Draw(i,this.Camera),this.DoOpen)if(this.Time<130){var e=.67*r-5*this.Time;i.drawImage(document.getElementById("envelopeTop"),0,0,a,e,0,0,a,e),i.save(),i.translate(0,e),i.scale(1,-1),i.drawImage(document.getElementById("envelopeTop"),0,e,a,.67*r,0,0,a,.67*r),i.restore(),i.drawImage(document.getElementById("envelopeBottom"),0,0)}else this.Time<452&&i.drawImage(document.getElementById("envelopeBottom"),0,3*(this.Time-130))},i.IntroState.prototype.CheckForChange=function(t){this.canChangeState&&t.ChangeState(new i.TitleState)},i.TitleState=function(){this.drawManager=null,this.camera=null,this.logoY=null,this.bounce=null,this.font=null,this.time=0,this.changeState=!1,this.Time=0,this.canChangeState=!1,t.MouseInput.Reset()},i.TitleState.prototype=new t.GameState,i.TitleState.prototype.Enter=function(){i.MPlayer.PlayMusicTrack("mainTheme"),this.drawManager=new t.DrawableManager,this.camera=new t.Camera;var e=new i.BackgroundGenerator(2048,15,!0,i.LevelType.Overground),s=new i.BackgroundRenderer(e.CreateLevel(),a,r,2);e.SetValues(2048,15,!1,i.LevelType.Overground);var h=new i.BackgroundRenderer(e.CreateLevel(),a,r,1);this.title=new t.Sprite,this.title.Image=t.Resources.Images.title,this.title.X=0,this.title.Y=120*n,this.logo=new t.Sprite,this.logo.Image=t.Resources.Images.logo,this.logo.X=0,this.logo.Y=0,this.font=i.SpriteCuts.CreateRedFont(),this.font.Strings[0]={String:"WAIT FOR IT",X:100*n+48,Y:1*n},this.fontNamesWhite=i.SpriteCuts.CreateWhiteFont(),this.fontNamesWhite.Strings[0]={String:"Nikol  &  Giorgos",X:95*n,Y:120*n+16},this.fontNamesBlack=i.SpriteCuts.CreateBlackFont(),this.fontNamesBlack.Strings[0]={String:"Nikol  &  Giorgos",X:95*n+n,Y:120*n+n+16},this.fontDateWhite=i.SpriteCuts.CreateWhiteFont(),this.fontDateWhite.Strings[0]={String:"09.09.2017",X:95*n+96,Y:120*n-40},this.fontDateBlack=i.SpriteCuts.CreateBlackFont(),this.fontDateBlack.Strings[0]={String:"09.09.2017",X:95*n+n+96,Y:120*n+n-40},this.logoY=20*n,this.drawManager.Add(s),this.drawManager.Add(h),this.bounce=0},i.TitleState.prototype.Exit=function(){this.drawManager.Clear(),delete this.drawManager,delete this.camera,delete this.font},i.TitleState.prototype.Update=function(t){this.Time++,150==this.Time&&(this.canChangeState=!0),this.bounce+=2*t,this.logoY=n*(20+10*Math.sin(this.bounce)),this.camera.X+=25*t,this.drawManager.Update(t)},i.TitleState.prototype.Draw=function(i){this.drawManager.Draw(i,this.camera),i.drawImage(t.Resources.Images.title,0,120*n),i.drawImage(t.Resources.Images.logo,0,this.logoY),this.font.Draw(i,this.Camera),this.fontNamesBlack.Draw(i,this.Camera),this.fontNamesWhite.Draw(i,this.Camera),this.fontDateBlack.Draw(i,this.Camera),this.fontDateWhite.Draw(i,this.Camera)},i.TitleState.prototype.CheckForChange=function(t){this.canChangeState&&t.ChangeState(new i.LevelState(5,i.LevelType.Castle))},i.LoadingState=function(){this.Images=[],this.ImagesLoaded=!1,this.ScreenColor=0,this.ColorDirection=1,this.ImageIndex=0,this.CanvasSelector=$("#canvas"),this.EnvelopeSelector=$("#envelope"),this.EnvelopeImageElem=this.EnvelopeSelector[0],this.LoadingDiv=$("#loadingContent")[0],this.LoadingDiv.innerHTML="Loading... (0 %)",this.Time=0,this.ChangeState=!1,this.NextState=new i.IntroState,this.DoOpen=!1},i.LoadingState.prototype=new t.GameState,i.LoadingState.prototype.Enter=function(){var e=0;for(e=0;e<16;e++)this.Images[e]={};this.Images[0].name="background",this.Images[1].name="endScene",this.Images[2].name="enemies",this.Images[3].name="fireMario",this.Images[4].name="font",this.Images[5].name="items",this.Images[6].name="logo",this.Images[7].name="map",this.Images[8].name="mario",this.Images[9].name="particles",this.Images[10].name="smallMario",this.Images[11].name="title",this.Images[12].name="ring",this.Images[13].name="paper",this.Images[14].name="wow",this.Images[15].name="poof",this.Images[0].src="images/bgsheet.png",this.Images[1].src="images/endscene.gif",this.Images[2].src="images/enemysheet.png",this.Images[3].src="images/firemariosheet.png",this.Images[4].src="images/font.gif",this.Images[5].src="images/itemsheet.png",this.Images[6].src="images/logoSaveTheDate.gif",this.Images[7].src="images/mapsheet.png",this.Images[8].src="images/mariosheet.png",this.Images[9].src="images/particlesheet.png",this.Images[10].src="images/smallmariosheet.png",this.Images[11].src="images/titleSaveTheDate.gif",this.Images[12].src="images/ring.png",this.Images[13].src="images/paper.jpg",this.Images[14].src="images/wow.png",this.Images[15].src="images/poof.png",t.Resources.AddImages(this.Images),i.Tile.LoadBehaviors()},i.LoadingState.prototype.Exit=function(){delete this.Images},i.LoadingState.prototype.Update=function(e){if(this.ImagesLoaded)document.getElementById("loadingContent").style.display="none",(t.KeyboardInput.IsKeyDown(t.Keys.S)||t.MouseInput.IsMouseDown(t.MouseKeys.LEFT)||t.MouseInput.IsMouseTap())&&(this.DoOpen=!0,i.MPlayer.PlaySound("envelope"));else{this.ImagesLoaded=!0;var s=0,h=0;for(s=0;s<this.Images.length;s++)t.Resources.Images[this.Images[s].name].complete!==!0?this.ImagesLoaded=!1:h++;this.LoadingDiv.innerHTML="Loading... ("+(100*h/this.Images.length|0)+" %)"}this.ScreenColor+=255*this.ColorDirection*e,this.ScreenColor>255?(this.ScreenColor=255,this.ColorDirection=-1):this.ScreenColor<0&&(this.ScreenColor=0,this.ColorDirection=1)},i.LoadingState.prototype.Draw=function(t){return this.ImagesLoaded?this.DoOpen?void(this.ChangeState=!0):(t.drawImage(document.getElementById("envelopeTop"),0,0),t.drawImage(document.getElementById("envelopeBottom"),0,0),void t.drawImage(document.getElementById("envelopeStamp"),480,480)):(t.drawImage(document.getElementById("envelopeTop"),0,0),void t.drawImage(document.getElementById("envelopeBottom"),0,0))},i.LoadingState.prototype.CheckForChange=function(e){this.ChangeState&&(i.MarioCharacter=new i.CharacterY,i.MarioCharacter.Image=t.Resources.Images.smallMario,i.MarioCharacter2=new i.Character2,this.NextState=new i.IntroState,e.ChangeState(this.NextState))},i.WinState=function(){this.waitTime=2,this.drawManager=null,this.camera=null,this.font=null,this.kissing=null,this.wasKeyDown=!1},i.WinState.prototype=new t.GameState,i.WinState.prototype.Enter=function(){this.drawManager=new t.DrawableManager,this.camera=new t.Camera,i.MPlayer.PlayMusicTrack("theendMusic"),this.font=i.SpriteCuts.CreateBlackFont(),this.font.Strings[0]={String:"Giorgos",X:40*n,Y:50*n},this.font.Strings[1]={String:"Nikoleta",X:210*n,Y:50*n},this.font.Strings[2]={String:"He proposed...",X:18*n,Y:100*n},this.font.Strings[3]={String:"She said yes!",X:200*n,Y:100*n},this.font.Strings[4]={String:"             Join us for our            ",X:-32,Y:130*n},this.font.Strings[5]={String:"           Wedding Celebration          ",X:-32,Y:140*n},this.font.Strings[6]={String:"              on 09.09.2017             ",X:-32,Y:160*n},this.font.Strings[7]={String:"            in Pieria, Greece            ",X:-32,Y:170*n},this.font.Strings[8]={String:"        Click for more information!     ",X:-32,Y:200*n},this.kissing=new t.AnimatedSprite,this.kissing.Image=t.Resources.Images.endScene,this.kissing.X=112*n,this.kissing.Y=16*n,this.kissing.SetColumnCount(2),this.kissing.SetRowCount(1),this.kissing.AddNewSequence("loop",0,0,0,1),this.kissing.PlaySequence("loop",!0),this.kissing.FramesPerSecond=.5,this.waitTime=2,this.drawManager.Add(this.font),this.drawManager.Add(this.kissing);var e=function(){console.log("Redirecting..."),window.location="https://docs.google.com/forms/d/e/1FAIpQLScU5zQvlmMyRZEFyRONaqUm_Gi6PRYnt8-rekuHXAt5imZMew/viewform?usp=sf_link"};document.addEventListener("click",e),document.getElementsByTagName("canvas")[0].addEventListener("click",e)},i.WinState.prototype.Exit=function(){this.drawManager.Clear(),delete this.drawManager,delete this.camera},i.WinState.prototype.Update=function(i){this.drawManager.Update(i),(t.MouseInput.IsMouseDown(t.MouseKeys.LEFT)||t.MouseInput.IsMouseTap())&&(window.location="https://docs.google.com/forms/d/e/1FAIpQLScU5zQvlmMyRZEFyRONaqUm_Gi6PRYnt8-rekuHXAt5imZMew/viewform?usp=sf_link")},i.WinState.prototype.Draw=function(t){t.fillStyle="#fff",t.fillRect(0,0,a,r),this.drawManager.Draw(t,this.camera)},i.WinState.prototype.CheckForChange=function(){},i.LevelState=function(i,e){this.LevelDifficulty=i,this.LevelType=e,this.Level=null,this.Layer=null,this.BgLayer=[],this.Paused=!1,this.Sprites=null,this.SpritesToAdd=null,this.SpritesToRemove=null,this.Camera=null,this.ShellsToCheck=null,this.FireballsToCheck=null,this.FontShadow=null,this.Font=null,this.StartTime=0,this.FireballsOnScreen=0,this.Tick=0,this.Delta=0,this.Time=0,this.FrameSize=16*n,this.CameraXMax=0,this.CameraYMax=0,this.Ring=null,this.GotoMapState=!1,this.Subtitles=[{Start:50,End:100,X:2,Y:15,Text:"THIS IS OUR HERO"},{Start:100,End:110,X:2,Y:15,Text:"THIS IS OUR HERO."},{Start:110,End:120,X:2,Y:15,Text:"THIS IS OUR HERO.."},{Start:120,End:240,X:2,Y:15,Text:"THIS IS OUR HERO..."},{Start:150,End:240,X:2,Y:16,Text:'(I MEAN... "HERO")'},{Start:280,End:340,X:20,Y:10,Text:"HE IS SEARCHING FOR"},{Start:280,End:340,X:20,Y:11,Text:"   HIS PRINCESS"},{Start:400,End:800,X:43,Y:4,Text:"     IT IS A"},{Start:400,End:800,X:44,Y:5,Text:"DANGEROUS MISSION"},{Start:450,End:800,X:45,Y:8,Text:"BUT SHE IS WORTH IT"},{Start:439,End:445,X:57,Y:24,Image:t.Resources.Images.poof},{Start:910,End:1170,X:105,Y:10,Text:"THE HERO HAD TO"},{Start:910,End:1170,X:105,Y:11,Text:"JUMP CLIFFS..."},{Start:975,End:1170,X:105,Y:13,Text:"   DO IT!!!"},{Start:985,End:1170,X:105,Y:14,Text:"   DO IT!!!"},{Start:995,End:1170,X:105,Y:15,Text:"   DO IT!!!"},{Start:1075,End:1079,X:110,Y:20,Image:t.Resources.Images.wow},{Start:1083,End:1087,X:110,Y:20,Image:t.Resources.Images.wow},{Start:1091,End:1095,X:110,Y:20,Image:t.Resources.Images.wow},{Start:1200,End:1590,X:135,Y:5,Text:"HE SPENT SOME TIME"},{Start:1220,End:1590,X:140,Y:6,Text:"SEARCHING FOR"},{Start:1240,End:1590,X:140,Y:7,Text:"SOMETHING SPECIAL..."},{Start:1550,End:1900,X:165,Y:10,Text:"(HE LOOKED EVERYWHERE)"},{Start:1700,End:1900,X:192,Y:25,Text:"(EVEN HERE!)"},{Start:1880,End:2060,X:220,Y:10,Text:"THE ROAD WAS LONG..."},{Start:1900,End:2060,X:230,Y:11,Text:"...AND CHALLENGING"},{Start:1980,End:2060,X:238,Y:18,Image:t.Resources.Images.wow},{Start:2060,End:2215,X:265,Y:11,Text:" BUT HE WAS"},{Start:2060,End:2215,X:265,Y:12,Text:"GETTING CLOSER"},{Start:2200,End:2570,X:285,Y:2,Text:"(LOVE AWAITS)"},{Start:2300,End:2570,X:300,Y:7,Text:"HE HAD TO"},{Start:2300,End:2570,X:300,Y:8,Text:"SUIT UP!"},{Start:2460,End:2800,X:308,Y:10,Text:"AND DO SOME AMAZING"},{Start:2460,End:2800,X:308,Y:11,Text:"   CLIFF JUMPS!"},{Start:2570,End:1e4,X:330,Y:10,Text:"   TO FIND WHAT"},{Start:2570,End:1e4,X:330,Y:11,Text:"HE WAS SEARCHING FOR"},{Start:2645,End:2737,X:336,Y:17,Text:"<-- NICE RING"},{Start:2645,End:2737,X:336,Y:18,
Text:"      DUDE!"},{Start:2805,End:2945,X:350,Y:18,Text:"NOW, THERE WAS ONLY"},{Start:2805,End:2945,X:358,Y:19,Text:"ONE THING LEFT..."},{Start:2965,End:4e3,X:375,Y:21,Text:"DO YOU..."},{Start:2995,End:4e3,X:385,Y:19,Text:"YES I DO!"}]},i.LevelState.prototype=new t.GameState,i.LevelState.prototype.Enter=function(){var e=new i.LevelGenerator(320,15),s=0,h=0,n=0,o=0,l=null;for(this.Level=e.CreateLevel(this.LevelType,this.LevelDifficulty),this.CameraXMax=this.Level.Width*this.FrameSize-a,this.CameraYMax=this.Level.Height*this.FrameSize-r,this.Paused=!1,this.Layer=new i.LevelRenderer(this.Level,a,r),this.Sprites=new t.DrawableManager,this.Camera=new t.Camera,this.Tick=0,this.ShellsToCheck=[],this.FireballsToCheck=[],this.SpritesToAdd=[],this.SpritesToRemove=[],this.FontShadow=i.SpriteCuts.CreateBlackFont(),this.Font=i.SpriteCuts.CreateWhiteFont(),s=0;s<2;s++)h=4>>s,n=((this.Level.Width*this.FrameSize-a)/h|0)+a,o=((this.Level.Height*this.FrameSize-r)/h|0)+r,l=new i.BackgroundGenerator(n/32+1,o/32+1,0===s,this.LevelType),this.BgLayer[s]=new i.BackgroundRenderer(l.CreateLevel(),a,r,h);i.MarioCharacter.Initialize(this),this.Sprites.Add(i.MarioCharacter),i.MarioCharacter2.Initialize(this),this.Sprites.Add(i.MarioCharacter2),this.StartTime=1,this.GotoMapState=!1,this.Ring=new i.RingAnim(this,3096,200)},i.LevelState.prototype.Exit=function(){delete this.Level,delete this.Layer,delete this.BgLayer,delete this.Sprites,delete this.Camera,delete this.ShellsToCheck,delete this.FireballsToCheck,delete this.FontShadow,delete this.Font},i.LevelState.prototype.CheckShellCollide=function(t){this.ShellsToCheck.push(t)},i.LevelState.prototype.CheckFireballCollide=function(t){this.FireballsToCheck.push(t)},i.LevelState.prototype.Update=function(t){var e=0,s=0,h=0,o=0,l=null,c=!1,d=0,u=0,m=0,p=null,g=0;for(this.Delta=t,this.StartTime>0&&this.StartTime++,this.Camera.X=i.MarioCharacter.X-160,this.Camera.X<0&&(this.Camera.X=0),this.Camera.X>this.CameraXMax&&(this.Camera.X=this.CameraXMax),this.FireballsOnScreen=0,e=0;e<this.Sprites.Objects.length;e++)(l=this.Sprites.Objects[e])!==i.MarioCharacter&&l!==i.MarioCharacter2&&(h=l.X-this.Camera.X,o=l.Y-this.Camera.Y,h<-64||h>a+64||o<-64||o>r+64?this.Sprites.RemoveAt(e):l instanceof i.Fireball&&this.FireballsOnScreen++);if(this.Paused)for(e=0;e<this.Sprites.Objects.length;e++)this.Sprites.Objects[e]===i.MarioCharacter||this.Sprites.Objects[e]===i.MarioCharacter2?this.Sprites.Objects[e].Update(t):this.Sprites.Objects[e].UpdateNoMove(t);else{for(this.Time++,this.Layer.Update(t),this.Level.Update(),c=!1,this.Tick++,d=(this.Camera.X/16|0)-1;d<=1+((this.Camera.X+this.Layer.Width)/16|0);d++)for(u=(this.Camera.Y/16|0)-1;u<=1+((this.Camera.Y+this.Layer.Height)/16|0);u++)if(m=0,16*d*n+8>i.MarioCharacter.X+16*n&&(m=-1),16*d*n+8<i.MarioCharacter.X-16*n&&(m=1),p=this.Level.GetSpriteTemplate(d,u),null!==p&&(p.LastVisibleTick!==this.Tick-1&&(null!==p.Sprite&&this.Sprites.Contains(p.Sprite)||p.Spawn(this,d,u,m)),p.LastVisibleTick=this.Tick),0!==m&&(g=this.Level.GetBlock(d,u),(i.Tile.Behaviors[255&g]&i.Tile.Animated)>0&&3==(g%16/4|0)&&0==(g/16|0)&&(this.Tick-2*d)%100==0)){for(e=0;e<8;e++)this.AddSprite(new i.Sparkle(this,16*d+8,16*u+(16*Math.random()|0),Math.random()*m,0,0,1,5));this.AddSprite(new i.BulletBill(this,16*d+8+8*m,16*u+15,m)),c=!0}for(c&&i.MPlayer.PlaySound("cannon"),e=0;e<this.Sprites.Objects.length;e++)this.Sprites.Objects[e].Update(t);for(e=0;e<this.Sprites.Objects.length;e++)this.Sprites.Objects[e].CollideCheck();for(e=0;e<this.ShellsToCheck.length;e++)for(s=0;s<this.Sprites.Objects.length;s++)this.Sprites.Objects[s]===this.ShellsToCheck[e]||this.ShellsToCheck[e].Dead||this.Sprites.Objects[s].ShellCollideCheck(this.ShellsToCheck[e])&&(i.MarioCharacter.Carried!==this.ShellsToCheck[e]||this.ShellsToCheck[e].Dead||(i.MarioCharacter.Carried=null,this.ShellsToCheck[e].Die()));for(this.ShellsToCheck.length=0,e=0;e<this.FireballsToCheck.length;e++)for(s=0;s<this.Sprites.Objects.length;s++)this.Sprites.Objects[s]===this.FireballsToCheck[e]||this.FireballsToCheck[e].Dead||this.Sprites.Objects[s].FireballCollideCheck(this.FireballsToCheck[e])&&this.FireballsToCheck[e].Die();this.FireballsToCheck.length=0}this.Sprites.AddRange(this.SpritesToAdd),this.Sprites.RemoveList(this.SpritesToRemove),this.SpritesToAdd.length=0,this.SpritesToRemove.length=0,this.Camera.X=n*(i.MarioCharacter.XOld+(i.MarioCharacter.X-i.MarioCharacter.XOld)*t)-a/2,this.Camera.Y=n*(i.MarioCharacter.YOld+(i.MarioCharacter.Y-i.MarioCharacter.YOld)*t)-r/2},i.LevelState.prototype.Draw=function(t){var e=0,s=0;for(this.Camera.X<0&&(this.Camera.X=0),this.Camera.Y<0&&(this.Camera.Y=0),this.Camera.X>this.CameraXMax&&(this.Camera.X=this.CameraXMax),this.Camera.Y>this.CameraYMax&&(this.Camera.Y=this.CameraYMax),e=0;e<2;e++)this.BgLayer[e].Draw(t,this.Camera);for(t.save(),t.translate(-this.Camera.X,-this.Camera.Y),e=0;e<this.Sprites.Objects.length;e++)0===this.Sprites.Objects[e].Layer&&this.Sprites.Objects[e].Draw(t,this.Camera);for(t.restore(),this.Layer.Draw(t,this.Camera),t.save(),t.translate(-this.Camera.X,-this.Camera.Y),e=0;e<this.Sprites.Objects.length;e++)1===this.Sprites.Objects[e].Layer&&this.Sprites.Objects[e].Draw(t,this.Camera);for(var e in this.Subtitles)this.Subtitles[e].Start<=this.Time&&this.Time<=this.Subtitles[e].End&&(void 0!==this.Subtitles[e].Image&&t.drawImage(this.Subtitles[e].Image,32*this.Subtitles[e].X,32*this.Subtitles[e].Y),void 0!==this.Subtitles[e].Text&&this.DrawStringShadow(t,this.Subtitles[e].Text,this.Subtitles[e].X,this.Subtitles[e].Y));2800==this.Time&&i.MPlayer.PlayMusicTrack("exitMusic"),2965==this.Time&&this.AddSprite(this.Ring),t.restore(),this.Time>3e3&&(s=this.Time-3e3|0,s=s*s*.5,this.RenderHeart(t,n*this.Ring.X-this.Camera.X,n*this.Ring.Y-this.Camera.Y,s)),3125==this.Time&&(this.GotoMapState=!0),this.StartTime>0&&(s=this.StartTime+this.Delta-2,s=s*s*.6,this.RenderBlackout(t,i.MarioCharacter.X*n-this.Camera.X|0,i.MarioCharacter.Y*n-this.Camera.Y|0,0|s)),i.MarioCharacter.WinTime>0&&(s=i.MarioCharacter.WinTime+this.Delta,s=s*s*.2,s>900&&(this.GotoMapState=!0),this.RenderBlackout(t,n*i.MarioCharacter.XDeathPos-this.Camera.X|0,n*i.MarioCharacter.YDeathPos-this.Camera.Y|0,a-n*s|0))},i.LevelState.prototype.DrawStringShadow=function(t,i,e,s){this.Font.Strings[0]={String:i,X:(8*e+4)*n,Y:(8*s+4)*n},this.FontShadow.Strings[0]={String:i,X:(8*e+4)*n+n,Y:(8*s+4)*n+n},this.FontShadow.Draw(t,this.Camera),this.Font.Draw(t,this.Camera)},i.LevelState.prototype.RenderHeart=function(t,i,e,s){t.save();var h=8*a/s;0!==s&&(h<4&&(h=4),t.fillStyle="#000",t.translate(i,e),t.beginPath(),t.scale(h,h),t.moveTo(0,-35),t.bezierCurveTo(0,-38,-5,-50,-25,-50),t.bezierCurveTo(-55,-50,-55,-12.5,-55,-12.5),t.bezierCurveTo(-55,5,-35,27,0,45),t.lineTo(0,r/2),t.lineTo(-a/2,r/2),t.lineTo(-a/2,-r/2),t.lineTo(0,-r/2),t.closePath(),t.stroke(),t.fill(),t.moveTo(0,-35),t.bezierCurveTo(0,-38,5,-50,25,-50),t.bezierCurveTo(55,-50,55,-12.5,55,-12.5),t.bezierCurveTo(55,5,35,27,0,45),t.lineTo(0,r/2),t.lineTo(a/2,r/2),t.lineTo(a/2,-r/2),t.lineTo(0,-r/2),t.closePath(),t.fill(),t.restore())},i.LevelState.prototype.RenderBlackout=function(t,i,e,s){if(!(s>a)){var h=[],n=[],o=0;for(o=0;o<16;o++)h[o]=i+Math.cos(o*Math.PI/15)*s|0,n[o]=e+Math.sin(o*Math.PI/15)*s|0;for(h[16]=0,n[16]=e,h[17]=0,n[17]=r,h[18]=a,n[18]=r,h[19]=a,n[19]=e,t.fillStyle="#000",t.beginPath(),t.moveTo(h[19],n[19]),o=18;o>=0;o--)t.lineTo(h[o],n[o]);for(t.closePath(),t.fill(),o=0;o<16;o++)h[o]=i-Math.cos(o*Math.PI/15)*s|0,n[o]=e-Math.sin(o*Math.PI/15)*s|0;for(n[15]+=5,h[16]=a,n[16]=e,h[17]=a,n[17]=0,h[18]=0,n[18]=0,h[19]=0,n[19]=e,t.fillStyle="#000",t.beginPath(),t.moveTo(h[0],n[0]),o=0;o<=h.length-1;o++)t.lineTo(h[o],n[o]);t.closePath(),t.fill()}},i.LevelState.prototype.AddSprite=function(t){this.Sprites.Add(t)},i.LevelState.prototype.RemoveSprite=function(t){this.Sprites.Remove(t)},i.LevelState.prototype.Bump=function(t,e,s){var h=this.Level.GetBlock(t,e),a=0,r=0;if(255==h?(this.BumpInto(t,e-1),this.Level.SetBlock(t,e,4),this.Level.SetBlockData(t,e,4),this.AddSprite(new i.RingAnim(this,16*t+8,16*e+8))):(i.Tile.Behaviors[255&h]&i.Tile.Bumpable)>0&&(this.BumpInto(t,e-1),this.Level.SetBlock(t,e,4),this.Level.SetBlockData(t,e,4),(i.Tile.Behaviors[255&h]&i.Tile.Special)>0?(i.MPlayer.PlaySound("sprout"),i.MarioCharacter.Large?i.MarioCharacter.Fire?this.AddSprite(new i.RingAnim(this,16*t+8,16*e+8)):this.AddSprite(new i.FireFlower(this,16*t+8,16*e+8)):this.AddSprite(new i.Mushroom(this,16*t+8,16*e+8))):(i.MarioCharacter.GetCoin(),i.MPlayer.PlaySound("coin"),this.AddSprite(new i.CoinAnim(this,t,e)))),(i.Tile.Behaviors[255&h]&i.Tile.Breakable)>0&&(this.BumpInto(t,e-1),s))for(i.MPlayer.PlaySound("breakblock"),this.Level.SetBlock(t,e,0),a=0;a<2;a++)for(r=0;r<2;r++)this.AddSprite(new i.Particle(this,16*t+8*a+4,16*e+8*r+4,4*(2*a-1),4*(2*r-1)-8))},i.LevelState.prototype.BumpInto=function(t,e){var s=this.Level.GetBlock(t,e),h=0;for((i.Tile.Behaviors[255&s]&i.Tile.PickUpable)>0&&(i.MarioCharacter.GetCoin(),i.MPlayer.PlaySound("coin"),this.Level.SetBlock(t,e,0),this.AddSprite(new i.CoinAnim(t,e+1))),h=0;h<this.Sprites.Objects.length;h++)this.Sprites.Objects[h].BumpCheck(t,e)},i.LevelState.prototype.CheckForChange=function(t){this.GotoMapState&&t.ChangeState(new i.WinState)},i.MusicPlayer=function(){var t=0,i="",e=new Audio,s=e.canPlayType("audio/aac"),h=e.canPlayType("audio/mp3"),a=e.canPlayType("audio/ogg");"maybe"==a&&t<1&&(t=1,i="ogg"),"maybe"==h&&t<1&&(t=1,i="mp3"),"maybe"==s&&t<1&&(t=1,i="aac"),"probably"==a&&t<2&&(t=2,i="ogg"),"probably"==h&&t<2&&(t=2,i="mp3"),"probably"==s&&t<2&&(t=2,i="aac"),this.Fmt=i,this.MusicFiles={mainTheme:"music/mainTheme."+this.Fmt,exitMusic:"music/exitMusic."+this.Fmt,theendMusic:"music/theendMusic."+this.Fmt},this.SoundFiles={envelope:"music/message."+this.Fmt,"1up":"music/1-up."+this.Fmt,breakblock:"music/breakblock."+this.Fmt,bump:"music/bump."+this.Fmt,cannon:"music/cannon."+this.Fmt,coin:"music/coin."+this.Fmt,death:"music/death."+this.Fmt,exit:"music/exit."+this.Fmt,fireball:"music/fireball."+this.Fmt,jump:"music/jump."+this.Fmt,kick:"music/kick."+this.Fmt,pipe:"music/pipe."+this.Fmt,powerdown:"music/powerdown."+this.Fmt,powerup:"music/powerup."+this.Fmt,sprout:"music/sprout."+this.Fmt,stagestart:"music/stagestart."+this.Fmt,stomp:"music/stomp."+this.Fmt},this.EmptySound="music/silence."+this.Fmt,this.LoopAudio=new Audio(this.EmptySound),this.NextMusicTrack=null,this.MusicTrack=new Audio(this.EmptySound),this.SoundBuffer=[];for(var r in this.SoundFiles)this.SoundBuffer[r]=new Audio(this.SoundFiles[r]);this.TotalChannels=8,this.ChannelIndex=0,this.Channels=[];for(var n=0;n<this.TotalChannels;++n)this.Channels[n]=new Audio(this.EmptySound);this.SoundQueue=[],this.Document=document},i.MusicPlayer.prototype={Bootstrap:function(){i.MPlayer.LoopAudio.onended=function(){null!=i.MPlayer.NextMusicTrack&&(i.MPlayer.MusicTrack.src=i.MPlayer.MusicFiles[i.MPlayer.NextMusicTrack],i.MPlayer.MusicTrack.play(),i.MPlayer.NextMusicTrack=null);for(var t=0;t<i.MPlayer.SoundQueue.length;++t){var e=i.MPlayer.ChannelIndex;i.MPlayer.ChannelIndex++,i.MPlayer.ChannelIndex>=i.MPlayer.TotalChannels&&(i.MPlayer.ChannelIndex=0),i.MPlayer.Channels[e].pause(),i.MPlayer.Channels[e].src=i.MPlayer.SoundFiles[i.MPlayer.SoundQueue[t]],i.MPlayer.Channels[e].play()}i.MPlayer.SoundQueue=[],i.MPlayer.LoopAudio.play()},document.getElementsByTagName("canvas")[0].addEventListener("click",i.MPlayer.OnClickFunction,!1),this.Document.addEventListener("keydown",i.MPlayer.OnClickFunction,!0)},OnClickFunction:function(){console.log("On Click"),document.getElementsByTagName("canvas")[0].removeEventListener("click",i.MPlayer.OnClickFunction,!1),i.MPlayer.Document.removeEventListener("keydown",i.MPlayer.OnClickFunction,!0),i.MPlayer.MusicTrack.play();for(var t=0;t<i.MPlayer.TotalChannels;++t)i.MPlayer.Channels[t].play();i.MPlayer.LoopAudio.play()},PlayMusicTrack:function(t){i.MPlayer.NextMusicTrack=t},PlaySound:function(t){i.MPlayer.SoundQueue.push(t)}};var a=1280,r=960,n=4,o=function(){var t=a/r,i=$(window).width()-15,e=$(window).height()-30;i/e>t?i=e*t:e=i/t;for(var s=$(".resizable"),h=0;h<s.length;++h)try{s[h].width=i,s[h].height=e}catch(t){console.log(s[h])}$("#moreContent")[0].style.width=i+"px",$("#moreContent")[0].style.top=e+"px"};$(window).on("resize",o),$(window).on("load",function(){o(),i.MPlayer=new i.MusicPlayer,i.MPlayer.Bootstrap(),(new t.Application).Initialize(new i.LoadingState,a,r)});